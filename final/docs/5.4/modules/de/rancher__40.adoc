= Rancher-Bereitstellung
:revdate: 2024-12-03
:page-revdate: {revdate}
:page-opendocs-origin: /02.deploying/03.rancher/03.rancher.md
:page-opendocs-slug: /deploying/rancher

== Bereitstellen und Verwalten von {product-name} über Rancher-Erweiterungen oder Apps & Marketplace

{product-name} kann entweder über Rancher Extensions für Prime-Kunden oder über Rancher Apps und Marketplace einfach bereitgestellt werden. Die standardmäßige (Helm-basierte) {product-name} Bereitstellung stellt {product-name} Container in den cattle-neuvector-system Namensraum bereit.

[NOTE]
====
Nur {product-name} Bereitstellungen über Rancher Extensions ({product-name}) der Rancher Version 2.7.0+, oder Apps & Marketplace der Rancher Version 2.6.5+ können direkt über Rancher verwaltet werden (Einzelanmeldung an {product-name} Konsole). Wenn Cluster zu Rancher hinzugefügt werden, auf denen {product-name} bereits installiert ist oder auf denen {product-name} direkt auf dem Cluster installiert wurde, werden diese Cluster nicht für die SSO-Integration aktiviert.
====

=== {product-name} UI-Erweiterung für Rancher

Rancher Prime-Kunden können {product-name} und die {product-name} UI Extension für Rancher problemlos einsetzen. Dies ermöglicht es Prime-Benutzern, bestimmte Funktionen und Ereignisse von {product-name} direkt über die Rancher-Benutzeroberfläche zu überwachen und zu verwalten. Für Community-Benutzer lesen Sie bitte den Abschnitt Bereitstellung {product-name} unten, um von Rancher Apps und Marketplace aus bereitzustellen.

. Der erste Schritt besteht darin, die Rancher Extensions-Fähigkeit global zu aktivieren, wenn sie nicht bereits aktiviert ist.
+
--
image:ui0_extensions.png[Erweiterungen]

image:ui1_enable.png[aktivieren.]
--
. Installieren Sie die {product-name}-UI-Ext aus der Liste Available
+
--
image:ui2_installext.png[installieren]
--
. Laden Sie die Erweiterung nach Abschluss der Installation neu
+
--
image:ui3reload.png[neu laden]
--
. Installieren Sie auf dem ausgewählten Cluster die Anwendung {product-name} auf der Registerkarte {product-name}, wenn die Anwendung {product-name} nicht bereits installiert ist. Dies sollte Sie zu den Schritten der App-Installation führen. Weitere Einzelheiten zu diesem Installationsprozess finden Sie im Abschnitt Bereitstellung von {product-name} weiter unten.
+
--
image:ui5installnv.png[install_nv]
--
. Das {product-name} Dashboard sollte nun über das Menü {product-name} für diesen Cluster angezeigt werden. Von diesem Dashboard aus kann eine Zusammenfassung des Sicherheitszustands des Clusters überwacht werden. Das Dashboard enthält interaktive Elemente, wie z. B. den Aufruf eines Assistenten zur Verbesserung Ihres (Sicherheitsrisiko-)Wertes, einschließlich der Möglichkeit, die automatische Suche nach Schwachstellen zu aktivieren, wenn diese nicht aktiviert ist.
+
--
image:ui6dashboard.png[dashboard]

Darüber hinaus bieten die Links in der oberen rechten Ecke des Dashboards bequeme SSO-Links (Single Sign On) zur vollständigen Konsole {product-name} für eine detailliertere Analyse und Konfiguration.
--
. Um die Erweiterung zu deinstallieren, gehen Sie zurück zur Seite Erweiterungen
+
--
image:ui7uninstall.png[einbauen]

[NOTE]
====
Durch die Deinstallation der {product-name} UI-Erweiterung wird die {product-name} App NICHT von jedem Cluster deinstalliert. Das Menü {product-name} stellt wieder einen SSO-Link zur Konsole {product-name} bereit.
====
--

=== Bereitstellung von {product-name}

Suchen Sie zunächst das Diagramm {product-name} in den Rancher-Diagrammen, wählen Sie es aus und prüfen Sie die Anweisungen und die verschiedenen Konfigurationswerte. (Optional) Erstellen Sie, falls gewünscht, ein Projekt für die Bereitstellung, z. B. {product-name}. Anmerkung: Wenn Sie mehr als ein {product-name} Diagramm sehen, wählen Sie nicht dasjenige aus, das für die Aktualisierung von älteren {product-name} 4.x Helm-Diagrammen vorgesehen ist.

image:rancher_chart.png[rancher_chart]

Stellen Sie das Diagramm {product-name} bereit, indem Sie zunächst die entsprechenden Werte für eine Rancher-Bereitstellung konfigurieren, z. B:

* Container-Laufzeit, z. B. docker für RKE und containerd für RKE2, oder wählen Sie den K3s-Wert, wenn Sie K3s verwenden.
* Manager-Service-Typ: Ändern Sie in LoadBalancer, falls in öffentlichen Cloud-Bereitstellungen verfügbar. Wenn der Zugang nur über Rancher erfolgen soll, ist hier jeder zulässige Wert möglich. Siehe den folgenden wichtigen Hinweis zum Ändern des Standard-Admin-Passworts in {product-name}.
* Geben Sie an, ob es sich bei diesem Cluster um einen primären Verbund mit mehreren Clustern oder um einen entfernten Cluster handelt (oder wählen Sie beides, wenn Sie eine der beiden Optionen wünschen).
* Persistentes Volume für Konfigurationssicherungen

image:rancher_chart_values.png[nv_values]

Klicken Sie auf "Installieren", nachdem Sie alle Diagrammwerte überprüft und aktualisiert haben.

Nach erfolgreicher Bereitstellung von {product-name} sehen Sie eine Zusammenfassung der Bereitstellungen, Daemon-Sets und des Cron-Jobs für {product-name}. Sie können die bereitgestellten Dienste auch im Menü "Services Discovery" auf der linken Seite sehen.

image:nv_deployed.png[im Einsatz]

=== Verwalten Sie {product-name}

Auf der linken Seite sehen Sie nun einen Menüpunkt {product-name}. Wenn Sie diesen auswählen, wird eine Kachel/Schaltfläche {product-name} angezeigt, die Sie zur Konsole {product-name} führt, wenn Sie darauf klicken, in einem neuen Tab.

image:nv_access.png[nv_console]

Wenn diese SSO-Zugangsmethode (Single Sign On) zum ersten Mal verwendet wird, wird ein entsprechender Benutzer im {product-name} -Cluster für die Rancher-Benutzeranmeldung erstellt. Der gleiche Benutzername wie der angemeldete Rancher-Benutzer wird in {product-name} erstellt, mit der Rolle admin oder fedAdmin und dem Identitätsanbieter Rancher.

image:nv_admin.png[Benutzer]

Beachten Sie im obigen Screenshot, dass zwei Rancher-Benutzer admin und gkosaka automatisch für SSO erstellt wurden. Wenn ein anderer Benutzer manuell in {product-name} erstellt wird, wird der Identitätsanbieter als {product-name} aufgeführt, wie unten gezeigt. Dieser lokale Benutzer kann sich direkt bei der Konsole {product-name} anmelden, ohne über Rancher zu gehen.

image:local_admin.png[.]

[IMPORTANT]
====
Es wird empfohlen, sich direkt bei der Konsole {product-name} als admin/admin anzumelden, um das Admin-Passwort manuell in ein sicheres Passwort zu ändern. Dadurch wird nur das Kennwort des Admin-Benutzers des Identitätsanbieters {product-name} geändert (möglicherweise sehen Sie einen anderen Admin-Benutzer, dessen Identitätsanbieter Rancher ist). Alternativ können Sie eine xref:configmap.adoc#_protect_sensitive_data_using_a_secret[ConfigMap als Geheimnis] in die anfängliche Bereitstellung von Rancher aufnehmen (siehe Diagrammwerte für ConfigMap-Einstellungen), um das Standard-Administrator-Passwort auf ein sicheres Passwort zu setzen.
====

=== NeuVector/Rancher SSO-Erlaubnis-Ressourcen

Die Benutzeroberfläche von Rancher v2.9.2 ermöglicht die Auswahl von NeuVector-Berechtigungsressourcen beim Erstellen von `Global/Cluster/Project/Namespaces` Rollen. Wenn einem Rancher-Benutzer eine Rolle mit einer NeuVector-Berechtigungsressource zugewiesen wird, wird der NeuVector SSO-Sitzung des Benutzers die entsprechende NeuVector-Berechtigung entsprechend zugewiesen. Dies dient dazu, SSO-Benutzern andere als die reservierten `admin/reader/fedAdmin/fedReader` -Rollen zur Verfügung zu stellen.

Im Folgenden sind die zugeordneten Berechtigungsressourcen aufgeführt, die mit den entsprechenden `Global/Cluster/Project/Namespaces` Rollen verwendet werden.

==== Zugeordnete Berechtigungsressourcen für die Rolle `Global/Cluster` 

[NOTE]
====
Benutzer müssen manuell * (Verben) / Dienste/Proxy (Ressourcen) zu NeuVector-bezogenen `Global/Cluster` Rollen hinzufügen.
====

API-Gruppen:

`permission.neuvector.com`

Verbs:

[,shell]
----
get    // for read-only(i.e. view)
*      // for read/write(i.e. modify)
----

Ressourcen:

NeuVector, Cluster skaliert

[,shell]
----
AdmissionControl
Authentication
CI Scan
Cluster
Federation
Vulnerability
----

NeuVector, namengebend

[,shell]
----
AuditEvents
Authorization
Compliance
Events
Namespace
RegistryScan
RuntimePolicy
RuntimeScan
SecurityEvents
SystemConfig
----

==== Zugeordnete Berechtigungsressourcen für die Rolle `Project/Namespace` 

[NOTE]
====
Benutzer müssen manuell * (Verben) / Dienste/Proxy (Ressourcen) zu NeuVector-bezogenen `Project/Namespace` Rollen hinzufügen.
====

API-Gruppen:

`permission.neuvector.com`

Verbs:

[,shell]
----
get    // for read-only(i.e. view)
*      // for read/write(i.e. modify)
----

Ressourcen:

NeuVector, namengebend

[,shell]
----
AuditEvents
Authorization
Compliance
Events
Namespace
RegistryScan
RuntimePolicy
RuntimeScan
SecurityEvents
SystemConfig
----

=== Deaktivieren von {product-name}/Rancher SSO

Um die Möglichkeit zu deaktivieren, sich über den Rancher Manager bei {product-name} anzumelden, gehen Sie zu Einstellungen -> Konfiguration.

image:rancher_sso.png[rancher_sso]

=== Rancher Legacy-Einsätze

Die Beispieldatei wird einen Manager und 3 Controller einsetzen. Es wird ein Enforcer auf jedem Knoten eingesetzt. Siehe den unteren Abschnitt zur Angabe von dedizierten Manager- oder Controllerknoten mit Hilfe von Knotenbeschriftungen. Anmerkung: Es wird nicht empfohlen, mehr als einen Manager hinter einem Load Balancer einzusetzen (zu skalieren), da es zu Problemen mit dem Sitzungsstatus kommen kann.

[NOTE]
====
Die Bereitstellung auf Rancher 2.x/Kubernetes sollte dem Kubernetes-Referenzabschnitt und/oder der Helm-basierten Bereitstellung folgen.
====

. Stellen Sie den Katalog docker-compose-dist.yml bereit, die Controller werden auf den gekennzeichneten Knoten bereitgestellt, die Enforcer auf den restlichen Knoten. (Die Beispieldatei kann so geändert werden, dass die Enforcer nur an den angegebenen Knoten eingesetzt werden).
. Wählen Sie eine der Steuerungen aus, mit der sich der Manager verbinden soll. Ändern Sie die Katalogdatei des Managers docker-compose-manager.yml, setzen Sie CTRL_SERVER_IP auf die IP des Controllers und verteilen Sie dann den Managerkatalog.

Hier sind die Beispiel-Compose-Dateien. Wenn Sie nur eine oder zwei der Komponenten einsetzen möchten, verwenden Sie einfach diesen Abschnitt der Datei.

Rancher Manager/Controller/Enforcer Musterdatei zusammenstellen:

[,yaml]
----
manager:
   scale: 1
   image: neuvector/manager
   restart: always
   environment:
     - CTRL_SERVER_IP=controller
   ports:
     - 8443:8443
controller:
   scale: 3
   image: neuvector/controller
   restart: always
   privileged: true
   environment:
     - CLUSTER_JOIN_ADDR=controller
   volumes:
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc:/host/proc:ro
     - /sys/fs/cgroup:/host/cgroup:ro
     - /var/neuvector:/var/neuvector
enforcer:
   image: neuvector/enforcer
   pid: host
   restart: always
   privileged: true
   environment:
     - CLUSTER_JOIN_ADDR=controller
   volumes:
     - /lib/modules:/lib/modules
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc:/host/proc:ro
     - /sys/fs/cgroup/:/host/cgroup/:ro
   labels:
     io.rancher.scheduler.global: true
----

== Bereitstellen ohne privilegierten Modus

Auf einigen Systemen wird die Bereitstellung ohne Verwendung des privilegierten Modus unterstützt. Diese Systeme müssen die Möglichkeit bieten, mit der Einstellung cap_add Fähigkeiten hinzuzufügen und das Scharfschaltungsprofil einzustellen.

In den Abschnitten über die Bereitstellung mit Docker-Compose und Docker UCP/Datacenter finden Sie Beispiele für Compose-Dateien.

Hier ist ein Beispiel für eine Rancher Compose-Datei für die Bereitstellung ohne privilegierten Modus:

[,yaml]
----
manager:
   scale: 1
   image: neuvector/manager
   restart: always
   environment:
     - CTRL_SERVER_IP=controller
   ports:
     - 8443:8443
controller:
   scale: 3
   image: neuvector/controller
   pid: host
   restart: always
   cap_add:
     - SYS_ADMIN
     - NET_ADMIN
     - SYS_PTRACE
   security_opt:
     - apparmor=unconfined
     - seccomp=unconfined
     - label=disable
   environment:
     - CLUSTER_JOIN_ADDR=controller
   volumes:
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc:/host/proc:ro
     - /sys/fs/cgroup:/host/cgroup:ro
     - /var/neuvector:/var/neuvector
enforcer:
   image: neuvector/enforcer
   pid: host
   restart: always
   cap_add:
     - SYS_ADMIN
     - NET_ADMIN
     - SYS_PTRACE
     - IPC_LOCK
   security_opt:
     - apparmor=unconfined
     - seccomp=unconfined
     - label=disable
   environment:
     - CLUSTER_JOIN_ADDR=controller
   volumes:
     - /lib/modules:/lib/modules
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc:/host/proc:ro
     - /sys/fs/cgroup/:/host/cgroup/:ro
   labels:
     io.rancher.scheduler.global: true
----

== Verwendung von Knotenetiketten für Manager- und Controller-Knoten

Um zu kontrollieren, auf welchen Knoten der Manager und der Controller eingesetzt werden, kennzeichnen Sie jeden Knoten. Wählen Sie die Knoten aus, an denen die Steuerungen eingesetzt werden sollen. Kennzeichnen Sie sie mit "nvcontroller=true". (Mit der aktuellen Beispieldatei kann nicht mehr als ein Controller auf demselben Knoten laufen).

Beschriften Sie den Manager-Knoten mit "`nvmanager=true`".

Fügen Sie Bezeichnungen in der yaml-Datei hinzu. Zum Beispiel für den Manager:

[,yaml]
----
   labels:
     io.rancher.scheduler.global: true
     io.rancher.scheduler.affinity:host_label: "nvmanager=true"
----

Für den Controller:

[,yaml]
----
   labels:
     io.rancher.scheduler.global: true
     io.rancher.scheduler.affinity:host_label: "nvcontroller=true"
----

Für den Enforcer, um zu verhindern, dass er auf einem Controller-Knoten läuft (falls gewünscht):

[,yaml]
----
  labels:
     io.rancher.scheduler.global: true
     io.rancher.scheduler.affinity:host_label_ne: "nvcontroller=true"
----
