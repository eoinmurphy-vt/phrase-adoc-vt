= Déployer en utilisant des opérateurs
:revdate: 2025-06-02
:page-revdate: {revdate}
:page-opendocs-origin: /02.deploying/01.production/02.operators/02.operators.md
:page-opendocs-slug: /déployer/production/opérateurs

== Opérateurs

Les opérateurs prennent les connaissances opérationnelles humaines et les codent dans un logiciel qui est plus facilement partagé avec les consommateurs. Les opérateurs sont des morceaux de logiciel qui facilitent la complexité opérationnelle de l'exécution d'un autre morceau de logiciel. Plus techniquement, les opérateurs sont une méthode d'emballage, de déploiement et de gestion d'une application Kubernetes.

== {product-name} Opérateurs

L'opérateur {product-name} est basé sur le graphique Helm {product-name}. L'opérateur {product-name} RedHat OpenShift s'exécute dans la plateforme de conteneurs OpenShift pour déployer et gérer les composants du cluster de sécurité {product-name}. L'opérateur {product-name} contient toutes les informations nécessaires pour déployer {product-name} en utilisant des graphiques Helm. Vous devez simplement installer l'opérateur {product-name} depuis le hub d'opérateurs intégré d'OpenShift et créer l'instance {product-name}.

Pour déployer les dernières versions de conteneurs {product-name}, utilisez soit le link:https://catalog.redhat.com/search?searchType=software&deployed_as=Operator&partnerName={product-name}&p=1[Opérateur certifié Red Hat] du hub d'opérateurs ou le link:https://github.com/redhat-openshift-ecosystem/community-operators-prod/tree/main/operators/neuvector-community-operator[opérateur communautaire]. La documentation pour l'opérateur communautaire peut être trouvée https://github.com/neuvector/neuvector-operator[{product-name} opérateur].

[NOTE]
.Remarque sur SCC et mise à niveau
====

Le SCC privilégié est ajouté au compte de service spécifié dans le yaml de déploiement par la version de l'opérateur 1.3.4 et supérieure dans les nouveaux déploiements. Dans le cas de la mise à niveau de l'opérateur {product-name} d'une version précédente à 1.3.4, veuillez supprimer le SCC privilégié avant la mise à niveau.

[,shell]
----
oc delete rolebinding -n neuvector system:openshift:scc:privileged
----
====

[IMPORTANT]
====
Les versions d'opérateurs certifiés {product-name} sont liées aux versions de produit {product-name}, et chaque nouvelle version doit passer par un processus de certification avec Red Hat avant d'être publiée. La version d'opérateur certifié pour 5.3.x est liée à la version helm 2.7.2 et à la version d'application {product-name} 5.3.2. La version d'opérateur certifié 1.3.9 est liée à la version {product-name} 5.2.0. La version d'opérateur certifié 1.3.7 est liée à la version {product-name} 5.1.0. La version 1.3.4 de l'opérateur est liée à {product-name} 5.0.0. Si vous souhaitez pouvoir changer les balises de version des {product-name} conteneurs déployés, veuillez utiliser la version Community.
====

.Déployer en utilisant l'opérateur certifié.
[%collapsible]
======
*Déployer en utilisant l'opérateur certifié Red Hat depuis Operator Hub*

[IMPORTANT]
====
{product-name} Les versions des opérateurs sont liées aux versions des {product-name} produits, et chaque nouvelle version de produit doit passer par un processus de certification avec Red Hat avant d'être publiée.
====

*Notes techniques*

* Les images de conteneurs {product-name} sont tirées de registry.connect.redhat.com en utilisant le secret de tirage d'image du marché RedHat.
* L'interface utilisateur du gestionnaire {product-name} est généralement exposée via un itinéraire de passage OpenShift sur un domaine. Par exemple, sur IBM Cloud neuvector-route-webui-neuvector.(nom_du_cluster)-(hash_aleatoire)-0000.(région).containers.appdomain.cloud. Elle peut également être exposée en tant que service neuvector-service-webui via une adresse de port de nœud ou une IP publique.
* Version OpenShift >=4.6.

. Créer le projet neuvector
+
--
[,shell]
----
oc new-project neuvector
----
--
. Installer l'opérateur certifié RedHat depuis l'Operator Hub 
** Dans l'interface utilisateur de la console OpenShift, naviguez vers OperatorHub 
** Recherchez l'opérateur {product-name} et sélectionnez l'annonce sans badge communautaire ou de marché 
** Cliquez sur Installer
. Configurer le canal de mise à jour 
** Le canal actuel le plus récent est beta, mais peut être déplacé vers stable à l'avenir 
** Sélectionnez stable si disponible
. Configurer le mode d'installation et l'espace de noms installé 
** Sélectionnez un espace de noms spécifique sur le cluster 
** Sélectionnez neuvector comme espace de noms installé 
** Configurer la stratégie d'approbation
. Confirmer l'installation
. Préparez les valeurs de configuration YAML pour l'installation de {product-name} comme indiqué dans l'exemple ci-dessous. Le YAML présenté dans la console OpenShift fournit toutes les options de configuration disponibles et leurs valeurs par défaut. 
+
image:operator_cert.png[]
. Lorsque l'opérateur est installé et prêt à l'emploi, une instance {product-name} peut être installée. 
** Cliquez sur Voir l'opérateur (après l'installation de l'opérateur) ou sélectionnez l'opérateur {product-name} dans la vue des opérateurs installés 
** Cliquez sur Créer une instance 
** Sélectionnez Configurer via la vue YAML 
** Collez les valeurs de configuration YAML préparées 
** Cliquez sur Créer
. Vérifiez l'installation de l'instance {product-name} 
** Accédez aux détails de l'opérateur de l'opérateur {product-name} 
** Ouvrez l'onglet {product-name} 
** Sélectionnez l'instance neuvector-default 
** Ouvrez l'onglet Ressources 
** Vérifiez que les ressources sont en statut Créé ou En cours d'exécution

Après avoir déployé avec succès la plateforme {product-name} sur votre cluster, connectez-vous à la console {product-name} à `https://neuvector-route-webui-neuvector.(OC_INGRESS)`. 
* Connectez-vous avec le nom d'utilisateur initial admin et le mot de passe admin. 
* Acceptez l'accord de licence utilisateur final {product-name}. 
* Changez le mot de passe de l'utilisateur admin. En option, vous pouvez également créer des utilisateurs supplémentaires dans le menu Paramètres -> Utilisateurs et rôles. Maintenant, vous êtes prêt à naviguer dans la console {product-name} pour commencer l'analyse des vulnérabilités, observer les pods d'application en cours d'exécution et appliquer des protections de sécurité aux conteneurs.

*Mettre à niveau {product-name}*

Mettez à niveau la version {product-name} en mettant à jour la version de l'Opérateur associée à la version {product-name} souhaitée.
======

.Déployer en utilisant l'Opérateur Communautaire
[%collapsible]
======
*Déployer en utilisant l'Opérateur Communautaire {product-name} depuis le Hub des Opérateurs*

*Notes techniques*

* Les images de conteneur {product-name} sont extraites de Docker Hub depuis le compte {product-name}. 
* L'interface utilisateur du gestionnaire {product-name} est généralement exposée via un itinéraire de passage OpenShift sur un domaine. Par exemple, sur IBM Cloud neuvector-route-webui-neuvector.(nom_du_cluster)-(hash_aleatoire)-0000.(région).containers.appdomain.cloud. Elle peut également être exposée en tant que service neuvector-service-webui via une adresse de port de nœud ou une IP publique. 
* OpenShift version 4.6+ 
* Il est recommandé de revoir et de modifier la configuration d'installation {product-name} en modifiant les valeurs yaml avant de créer l'instance {product-name}. Les exemples incluent le nom des imagePullSecrets, la version de balise, l'accès ingress/console, la fédération multi-cluster, le PVC de volume persistant, etc. Veuillez vous référer aux instructions Helm à https://github.com/neuvector/neuvector-helm pour les valeurs qui peuvent être modifiées lors de l'installation.

. Créer le projet neuvector
+
--
[,shell]
----
oc new-project neuvector
----
--
. Installez l'Opérateur Communautaire {product-name} depuis le Hub des Opérateurs 
** Dans l'interface utilisateur de la console OpenShift, naviguez vers OperatorHub 
** Recherchez l'Opérateur {product-name} et sélectionnez l'annonce avec le badge communautaire 
** Cliquez sur Installer 
** Configurer le canal de mise à jour. Le canal actuel le plus récent est beta, mais il peut être déplacé vers stable à l'avenir. Sélectionnez stable si disponible. 
** Configurer le mode d'installation et l'espace de noms installé 
** Sélectionnez un espace de noms spécifique sur le cluster 
** Sélectionnez neuvector comme espace de noms installé 
** Configurer la stratégie d'approbation 
** Confirmer l'installation
. Téléchargez le manifeste secret Kubernetes qui contient les informations d'identification pour accéder au registre de conteneurs {product-name}. Enregistrez le fichier manifeste YAML sous ./neuvector-secret-registry.yaml.
. Appliquez le manifeste secret Kubernetes contenant les informations d'identification du registre.
+
--
[,shell]
----
kubectl apply -n neuvector -f ./neuvector-secret-registry.yaml
----
--
. Préparez les valeurs de configuration YAML pour l'installation de {product-name} en commençant par le snippet YAML suivant. Assurez-vous de spécifier la version {product-name} souhaitée dans la valeur 'tag'. Vérifiez la référence des valeurs dans le chart Helm {product-name} pour obtenir les options de configuration disponibles. Il existe d'autres valeurs Helm possibles qui peuvent être configurées dans le YAML, telles que la configuration du cluster pour permettre la gestion multi-cluster en exposant les services Master (Master fédéré) ou distant (Travailleur fédéré).
+
--
[,yaml]
----
apiVersion: apm.neuvector.com/v1alpha1
kind: Neuvector
metadata:
  name: neuvector-default
  namespace: neuvector
spec:
  openshift: true
  tag: 4.3.0
  registry: docker.io
  exporter:
    image:
      repository: prometheus-exporter
      tag: 0.9.0
  manager:
    enabled: true
    env:
      ssl: true
    image:
      repository: manager
    svc:
      type: ClusterIP
      route:
        enabled: true
        termination: passthrough
  enforcer:
    enabled: true
    image:
      repository: enforcer
  cve:
    updater:
      enabled: true
      image:
        repository: updater
        tag: latest
      schedule: 0 0 * * *
    scanner:
      enabled: true
      replicas: 3
      image:
        repository: scanner
        tag: latest
  controller:
    enabled: true
    image:
      repository: controller
    replicas: 3
----
--
. Lorsque l'opérateur est installé et prêt à l'emploi, une instance {product-name} peut être installée. 
** Cliquez sur Voir l'opérateur (après l'installation de l'opérateur) ou sélectionnez l'opérateur {product-name} dans la vue des opérateurs installés 
** Cliquez sur Créer une instance 
** Sélectionnez Configurer via la vue YAML 
** Collez les valeurs de configuration YAML préparées 
** Cliquez sur Créer
. Vérifiez l'installation de l'instance {product-name}. 
** Accédez aux détails de l'opérateur de l'opérateur {product-name} 
** Ouvrez l'onglet {product-name} 
** Sélectionnez l'instance neuvector-default 
** Ouvrez l'onglet Ressources 
** Vérifiez que les ressources sont en statut Créé ou En cours d'exécution
. Après avoir déployé avec succès la plateforme {product-name} sur votre cluster, connectez-vous à la console {product-name} à `https://neuvector-route-webui-neuvector.(INGRESS_DOMAIN)`. 
** Connectez-vous avec le nom d'utilisateur initial admin et le mot de passe admin. 
** Acceptez l'accord de licence utilisateur final {product-name}. 
** Changez le mot de passe de l'utilisateur admin. 
** En option, vous pouvez également créer des utilisateurs supplémentaires dans le menu Paramètres -> Utilisateurs et rôles.

Vous êtes maintenant prêt à naviguer dans la console {product-name} pour commencer l'analyse des vulnérabilités, observer les pods d'application en cours d'exécution et appliquer des protections de sécurité aux conteneurs.

*Mettre à niveau {product-name}*

. De Opérateurs > Opérateurs installés > Opérateur {product-name} 
+
image:1_Installed.png[]
. Cliquez sur {product-name} pour lister les instances 
+
image:2_Instance.png[]
. Cliquez sur YAML pour modifier les paramètres 
+
image:3_YAML.png[]
. Mettez à jour le tag et cliquez sur Enregistrer 
+
image:4_tag_save.png[]
======

=== Dépannage

* Vérifiez les valeurs de déploiement de l'opérateur dans le fichier yaml déployé
* Vérifiez que la contrainte de contexte de sécurité (SCC) pour {product-name} à l'étape 2 a été ajoutée avec succès
* Examinez et vérifiez les valeurs du chart Helm {product-name}
* Assurez-vous que le chemin du registre et le tag de version sont correctement définis (opérateur communautaire ; certifié utilisera les valeurs par défaut)
* Assurez-vous que la route vers le service de gestion {product-name} neuvector-route-webui est configurée.
