= Groupes
:revdate: 2024-09-27
:page-revdate: {revdate}
:page-opendocs-origin: /05.policy/04.groups/04.groups.md
:page-opendocs-slug:  /politique/groupes

== Politique : Groupes

Ce menu permet de visualiser et de gérer les règles de sécurité et de personnaliser les groupes à utiliser dans les règles. Il permet également de passer d'un mode de groupe à l'autre (découverte, surveillance et protection). Les groupes de conteneurs peuvent avoir des règles de processus/fichier dans un mode différent des règles de réseau, comme décrit xref:modes.adoc#_network_service_policy_mode[ici.] Veuillez consulter les sections individuelles suivantes pour obtenir des explications sur les contrôles de conformité personnalisés, les règles de réseau, les règles d'accès aux processus et aux fichiers et la détection DLP/WAF. Remarque : Les règles de réseau peuvent être visualisées dans le menu Groupes pour n'importe quel groupe, mais doivent être modifiées séparément dans le menu xref:networkrules.adoc[Règles de réseau.] 

{product-name} crée automatiquement des groupes à partir de vos applications en cours d'exécution. Ces groupes commencent par le préfixe "nv". Vous pouvez également les ajouter manuellement à l'aide d'un CRD ou de l'API REST et ils peuvent être créés dans n'importe quel mode, Découvrir, Surveiller ou Protéger. Les règles de réseau et de réponse nécessitent ces définitions de groupe. Pour les groupes créés automatiquement (groupes "appris" commençant par "nv"), {product-name} apprendra les règles de réseau et de processus et les ajoutera en mode découverte. Les groupes personnalisés n'apprendront pas et ne rempliront pas automatiquement les règles. Remarque : les groupes "nv." commencent par xref:processrules.adoc#_zero_drift_process_protection[zéro dérive] activée par défaut pour les protections de processus/fichiers.

image:5_groups.png[groupes]

Il est pratique de voir des groupes de conteneurs et d'appliquer des règles à chaque groupe. {product-name} crée une liste de groupes basée sur les images de conteneurs. Par exemple, tous les conteneurs démarrés à partir d'une image Wordpress seront dans le même groupe. Des règles sont automatiquement créées et appliquées au groupe de conteneurs.

L'écran Groupes affiche également une icône "Scorable" en haut à droite. Il est possible de sélectionner un groupe appris et d'activer ou de désactiver la case à cocher "Scorable". Cette option permet de contrôler les conteneurs utilisés pour calculer la note de risque de sécurité dans le tableau de bord. Pour plus de détails, voir xref:improve-score.adoc#_improving_the_security_risk_score[Améliorer le score de risque de sécurité].

L'écran Groupes est également l'endroit où le fichier CRD yaml pour la "politique de sécurité en tant que code" peut être importé et exporté. Sélectionnez un ou plusieurs groupes et cliquez sur le bouton Exporter la stratégie de groupe pour télécharger le fichier yaml. Voir la section xref:usingcrd.adoc[CRD] pour plus de détails sur l'utilisation des CRD. Important : Chaque groupe sélectionné ET tous les groupes liés par des règles de réseau seront exportés (c'est-à-dire le groupe et tout autre groupe auquel il est connecté par le biais des règles de réseau de la liste blanche).

=== Suppression automatique des groupes inutilisés

Les groupes appris (pas les groupes réservés ou personnalisés) peuvent être automatiquement supprimés par {product-name} s'il n'y a plus de membres (conteneurs) dans le groupe. La durée de cette période est configurable dans Settings -> Configuration.

=== Protection de l'hôte - le groupe "Nœuds

{product-name} crée automatiquement un groupe appelé "nodes" qui représente chaque nœud (hôte) dans le cluster. {product-name} fournit une surveillance de base automatisée des hôtes pour les processus suspects (tels que les balayages de port, les shells inversés, etc.) et les élévations de privilèges. En outre, {product-name} apprendra le comportement des processus de chaque nœud lorsqu'il est en mode découverte afin d'établir une liste blanche de ces processus, de la même manière que pour les processus des conteneurs.  La liste des règles de processus "locales" (apprises) est une combinaison de tous les processus de tous les nœuds de la grappe en mode découverte.

Les nœuds peuvent alors être mis en mode "Monitor" ou "Protect", où {product-name} alertera si un processus démarre en mode "Monitor", et bloquera ce processus en mode "Protect".

image:host_protection.png[nodeGroup]

Pour activer la protection de l'hôte avec des règles de profil de processus, sélectionnez le groupe "nœuds" et examinez les processus appris sur le nœud. Personnalisez si nécessaire en ajoutant, supprimant ou modifiant les règles du processus. Passez ensuite au mode Moniteur ou Protéger.

[NOTE]
====
Les connexions réseau qui enfreignent les règles indiquées dans les règles de réseau pour les nœuds ne sont jamais bloquées, même en mode protection. Seules les violations de processus sont bloquées en mode protection sur les nœuds.
====

=== Groupes personnalisés

Les groupes peuvent être ajoutés manuellement en saisissant les critères du groupe. Remarque : Les groupes créés sur mesure n'ont pas de mode de protection. En effet, ils peuvent contenir des conteneurs de différents groupes sous-jacents, chacun d'entre eux pouvant se trouver dans un mode différent, ce qui entraîne une certaine confusion quant au comportement.

Les groupes peuvent être créés par :

* *Images*
+
____
Sélectionnez les conteneurs en fonction de leur nom d'image. Exemples : image=wordpress, image@redis
____

* *Nœuds*
+
____
Sélectionner les conteneurs en fonction des nœuds sur lesquels ils s'exécutent. Examples: node=ip-12-34-56-78.us-west-2
____

* *Conteneurs individuels*
+
____
Sélectionner les conteneurs en fonction de leur nom d'instance. Exemples : container=nodejs_1, container@nodejs
____

* *Services*
+
____
Sélectionnez les conteneurs en fonction de leurs services. Si un conteneur est déployé par Docker Compose, sa valeur de balise de service sera "nom_du_projet:nom_du_service" ; si un conteneur est déployé par le service Docker en mode essaim, sa valeur de balise de service sera le nom du service essaim.
____

* *Étiquettes*
+
____
Sélectionner les récipients en fonction de leur étiquette. Exemples : com.docker.compose.project=wordpress, location@us-west
____

* *Adresses*
+
____
Créer un groupe par nom DNS ou par plage d'adresses IP. Exemples : address=www.google.com, address=10.1.0.1, address=10.1.0.0/24, address=10.1.0.1-10.1.0.25. Le nom DNS peut être n'importe quel nom pouvant être résolu. Les critères d'adresse n'acceptent pas l'opérateur !=. Voir ci-dessous pour les groupes d'adresses spéciaux d'hôtes virtuels "vh".
____

Un groupe peut être créé avec des types de critères mixtes, à l'exception du type "adresse", qui ne peut pas être utilisé avec d'autres critères. Les critères mixtes imposent une opération '`AND`' entre les critères, par exemple label service_type=data AND image=mysql. Les entrées multiples pour un ou plusieurs critères sont traitées comme des OU, par exemple address=google.com OR address=yahoo.com. Remarque : Pour faciliter l'analyse des connexions d'entrée et de sortie, une liste des IP d'entrée et de sortie peut être téléchargée à partir du tableau de bord ( -> ) sous la forme d'un rapport d'exposition.

La correspondance partielle est prise en charge pour les critères d'image, de nœud, de conteneur, de service et d'étiquette. Par exemple, image@redis, sélectionne les conteneurs dont le nom d'image contient la sous-chaîne "redis" ; image{caret}redis, sélectionne les conteneurs dont le nom d'image commence par "redis".

Il n'est pas recommandé d'utiliser des critères d'adresse pour faire correspondre des IP ou des sous-réseaux internes, en particulier ceux qui sont protégés par des agents d'exécution. Il est plutôt recommandé d'utiliser leurs métadonnées, telles que l'image, le service ou les étiquettes. Les cas d'utilisation typiques du groupe d'adresses consistent à définir des politiques entre les conteneurs gérés et les sous-réseaux IP externes, par exemple les services fonctionnant sur Internet ou dans un autre centre de données. Le groupe d'adresses n'a pas de membres.

Les caractères génériques_'' peuvent être utilisés dans les critères, par exemple 'address=_.google.com'. Pour une correspondance plus souple, utilisez le tilde '~' pour indiquer qu'une correspondance regex est souhaitée. Par exemple, pour faire correspondre les étiquettes 'policy~public.*-ext1' à la politique d'étiquetage.

[NOTE]
====
Les caractères spéciaux utilisés après un "=" dans les critères peuvent ne pas correspondre correctement. Par exemple, le point '. Dans 'policy=public_', la correspondance ne se fera pas correctement, et il faut utiliser une expression rationnelle, comme 'policy~public_'.
====

Après avoir enregistré un nouveau groupe, {product-name} affichera les membres de ce groupe. Des règles peuvent ensuite être créées à l'aide de ces groupes.

==== Politique de réseau basée sur les hôtes virtuels ("vh")

Les groupes personnalisés peuvent prendre en charge des groupes d'adresses basés sur des hôtes virtuels. Cela permet de résoudre un cas d'utilisation où deux adresses FQDN différentes sont résolues à la même adresse IP, mais où des règles différentes doivent être appliquées pour chaque FQDN. Un nouveau groupe personnalisé avec '`address=vh:xxx.yyy`' peut être créé à l'aide de l'indicateur '`vh:`' pour activer cette protection. Une règle de réseau peut alors utiliser le groupe personnalisé comme source '`From`' sur la base du nom d'hôte virtuel (au lieu de l'adresse IP résolue) afin d'appliquer des règles différentes pour les hôtes virtuels.

== Exemples de groupes personnalisés

=== Critères généraux

* Pour sélectionner tous les conteneurs (l'un ou l'autre des exemples ci-dessous fonctionnera)
+
____
container=&lowast;
service=&lowast;
____

* Pour sélectionner tous les conteneurs de l'espace de noms "default" (espace de noms pris en charge à partir de la version 2.2)
+
____
namespace=default
____

* Pour sélectionner tous les conteneurs dont le nom de service commence par "nginx".
+
____
service=nginx&lowast;
____

* Pour sélectionner tous les conteneurs dont le nom de service contient "etcd".
+
____
service=&lowast;etcd&lowast;
____

* Pour sélectionner tous les conteneurs dans l'espace de noms "apache1" ou "apache2" (appuyez sur la touche "Entrée" après chaque entrée)
+
____
namespace=apache1 namespace=apache2
____

* Pour sélectionner tous les conteneurs qui ne se trouvent PAS dans l'espace de noms "apache1" et "apache2" (appuyez sur la touche "Entrée" après chaque entrée)
+
____
namespace!=apache1 namespace!=apache2
____

* Pour sélectionner tous les conteneurs de l'espace de noms "apache1~9".
+
____
namespace~apache[1-9]
____

=== Critères d'adresse IP

* Toutes les adresses IP externes
+
____
Veuillez utiliser le groupe par défaut '`external`' dans les règles
____

* Sous-réseau IP 10.0.0.0/8
+
____
address=10.0.0.0/8
____

* Plage IP
+
____
address=10.0.0.0-10.0.0.15
____

* dropbox.com et ses sous-domaines (appuyez sur entrée après chaque entrée)
+
____
address=dropbox.com address=*.dropbox.com
____
