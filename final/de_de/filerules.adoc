= Test_DreiDateizugriffsregeln
:revdate: 2024-09-27
:page-revdate: {revdate}
:page-opendocs-origin: /05.policy/07.filerules/07.filerules.md
:page-opendocs-slug:  /policy/filerules

== Test_ThreePolicy: Dateizugriffsregeln

Es gibt zwei Arten von Prozess-/Dateischutz in \{product-name}. Die eine ist Zero-Drift, bei der erlaubte Prozess- und Dateiaktivitäten automatisch basierend auf dem Container-Image bestimmt werden, und die zweite ist ein verhaltensbasiertes Lernen. Jede kann angepasst werden (Regeln manuell hinzugefügt), wenn gewünscht.

\{product-name} hat eine integrierte Erkennung verdächtiger Aktivitäten im Dateisystem. Empfindliche Dateien in Containern ändern sich normalerweise zur Laufzeit nicht. Durch die Modifikation des Inhalts der sensiblen Dateien kann ein Angreifer unbefugte Berechtigungen erlangen, wie im Dirty-Cow-Angriff auf den Linux-Kernel, oder die Integrität des Systems schädigen, beispielsweise durch Manipulation der /etc/hosts-Datei. Die meisten Container laufen nicht im Nur-Lese-Modus. Jede verdächtige Aktivität in Containern, Hosts oder dem \{product-name} Enforcer-Container selbst wird erkannt und in den Benachrichtigungen -> Sicherheitsereignisse protokolliert.

=== Test_DreiZero-Drift-Dateischutz

Dies ist der Standardmodus für Prozess- und Dateischutz. Zero-Drift erlaubt automatisch nur Prozesse, die vom übergeordneten Prozess stammen, der im ursprünglichen Container-Image ist, und erlaubt keine Dateiaktualisierungen oder die Installation neuer Dateien. Im Entdeckungs- oder Überwachungsmodus wird Zero-Drift bei verdächtigen Prozess- oder Dateiaktivitäten Alarm schlagen. Im Schutzmodus wird solche Aktivität blockiert. Zero-Drift erfordert nicht, dass Dateiaktivitäten zu einer Erlauben-Liste hinzugefügt werden. Das Deaktivieren von Zero-Drift für eine Gruppe führt dazu, dass die für die Gruppe aufgeführten Prozess- und Dateiregeln stattdessen wirksam werden.

[NOTE]
====
Die für jede Gruppe aufgeführten Prozess-/Dateiregeln werden immer angewendet, selbst wenn Zero-Drift aktiviert ist. Dies bietet eine Möglichkeit, Ausnahmen für Erlauben/Verweigern zu den Basis-Null-Drift-Schutzmaßnahmen hinzuzufügen. Beachten Sie, dass, wenn eine Gruppe im Entdeckungsmodus startet, Prozess-/Dateiregeln automatisch zur Liste hinzugefügt werden können und vor dem Wechsel in die Überwachungs-/Schutzmodi überprüft und bearbeitet werden sollten.
====

Die Möglichkeit, den Null-Drift-Modus zu aktivieren/deaktivieren, befindet sich in der Konsole in den Richtlinien -> Gruppen. Mehrere Gruppen können ausgewählt werden, um diese Einstellung für alle ausgewählten Gruppen umzuschalten.

=== Test_DreiBasis-Dateischutzmaßnahmen

Wenn eine Paketinstallation erkannt wird, wird ein automatischer erneuter Scan des Containers oder Hosts ausgelöst, um etwaige Schwachstellen zu erkennen, WENN der automatisierte Scan in Sicherheitsrisiken -> Schwachstellen aktiviert wurde.

Zusätzlich zur Überwachung vordefinierter Dateien/Verzeichnisse können Benutzer benutzerdefinierte Dateien/Verzeichnisse hinzufügen, die überwacht werden sollen, und solche Dateien/Verzeichnisse daran hindern, geändert zu werden.

[IMPORTANT]
====
\{product-name} warnt und blockiert keine Änderungen an vordefinierten Dateien/Verzeichnissen oder in Systemcontainern wie Kubernetes. Das Blockieren ist nur eine Option für benutzerkonfigurierte benutzerdefinierte Dateien/Verzeichnisse für Nicht-Systemcontainer. Dies soll verhindern, dass regelmäßige Updates von Systemordnern oder sensiblen Konfigurationen unbeabsichtigt blockiert werden, was zu unberechenbarem Systemverhalten führt.
====

Die folgenden Dateien und Verzeichnisse werden standardmäßig überwacht:

* Ausführbare Dateien
* Sensible setuid/setgid-Dateien
* Systembibliotheken, libc, pthread, ...
* Paketinstallation, Debian/Ubuntu, RedHat/CentOS, Alpine
* Sensible Systemdateien, /etc/passwd, /etc/hosts, /etc/resolv.conf ...
* Ausführbare Dateien laufender Prozesse

Die folgenden Aktivitäten werden überwacht:

* Dateien, Verzeichnisse, Symlinks (harte Links und weiche Links)
* erstellt, gelöscht, geändert (Inhaltsänderung) und verschoben

Unten finden Sie eine Liste der Dateisystemüberwachung und was überwacht wird (Container, Host/Knoten und/oder \{product-name} Durchsetzungscontainer selbst):

* /bin, /usr/bin, /usr/sbin, /usr/local/bin - Container, Durchsetzung
* Dateien mit setuid- und setgid-Attribut - Container, Host, Durchsetzung
* Bibliotheken: libc, pthread, ld-linux.* - Container, Host, Durchsetzung
* Paketinstallation: dpkg, rpm, apk - Container, Host, Durchsetzung
* /etc/hosts, /etc/passwd, /etc/resolv.conf - Container, Host, Durchsetzung
* Binaries der laufenden Prozesse - Container

=== Test_DreiVerhaltensbasiertes Lernen erlaubter Anwendungen im Entdeckungsmodus

Im Entdeckungsmodus kann \{product-name} Anwendungen NUR für bestimmte Verzeichnisse oder Dateien lernen und auf die Whitelist setzen. Um das Lernen zu aktivieren, muss eine benutzerdefinierte Regel erstellt werden und die Aktion muss auf Blockieren gesetzt werden, wie unten beschrieben.

=== Test_DreiErstellen benutzerdefinierter Datei-/Verzeichnisüberwachungsregeln

Benutzerdefinierte Datei-Zugriffsregeln können sowohl für benutzerdefinierte, vom Benutzer definierte Gruppen als auch für automatisch erlernte Gruppen erstellt werden.

Benutzer können neue Einträge für Datei-/Verzeichnisregeln hinzufügen.

* Filter: Konfigurieren Sie die zu schützende Datei/Ordner (Wildcard-Zeichen werden unterstützt)
* Setzen Sie das rekursive Flag (wenn alle Dateien in den Unterverzeichnissen geschützt werden sollen)
* Wählen Sie die Aktion, Überwachen oder Blockieren (siehe Aktionen unten)
* Geben Sie erlaubte Anwendungen ein (siehe Hinweis 1 unten)

image:file_rules.png[FileRules]

Aktionen:

* Überwachen Sie Dateiänderungen. Benachrichtigungen (Alerts) für Änderungen generieren
* Unbefugten Zugriff blockieren.
** Dienst im Entdeckungsmodus: Das Zugriffsverhalten auf die Datei wird erlernt (die Prozesse/Anwendungen, die auf die geschützte Datei zugreifen) und zu den erlaubten Anwendungen hinzugefügt.
** Dienst im Überwachungsmodus: Unerwartetes Datei-Verhalten wird gemeldet.
** Dienst im Schutzmodus: Unerwarteter Zugriff (lesen, ändern) wird blockiert. Die Erstellung neuer Dateien in geschützten Ordnern wird ebenfalls blockiert.

[NOTE]
====
Wenn die Regel auf Blockieren eingestellt ist und der Dienst im Entdeckungsmodus ist, wird \{product-name} die Anwendungen, die auf die Datei zugreifen, erlernen und diese zu den erlaubten Anwendungen für die Regel hinzufügen.
====

[NOTE]
====
Container-Plattformen, die den AUFS-Speicher-Driver verwenden, unterstützen die Verweigerung (Blockieren) im Schutzmodus beim Erstellen/Ändern von Dateien aufgrund der Einschränkungen des Treibers nicht. Das Verhalten wird im Überwachungsmodus gleich sein, mit Warnungen bei verdächtigen Aktivitäten.
====

=== Test_DreiDateizugriffsregel Reihenfolge Priorität

Ein Container kann Zugriffsregeln für Dateien von mehreren benutzerdefinierten Gruppen und von Benutzern erstellten Zugriffsregeln für Dateien in der automatisch gelernten Gruppe erben.

Zugriffsregeln für Dateien haben die folgende Priorität, wenn der Dateiname mit vordefinierten Zugriffsregeln der automatisch gelernten Gruppe und den Regelvererbungen mehrerer Gruppen in Konflikt steht.

* Zugriffsregel für Dateien mit blockiertem Zugriff (höchste Priorität)
* Zugriffsregel für Dateien mit aktivierter Rekursion
* Zugriffsregel für Dateien mit deaktivierter Rekursion
* Benutzerdefinierte Zugriffsregel für Dateien, die von vordefinierten Zugriffsregeln abweicht

==== Test_ThreeExamples

Zugriffsregel anzeigen, um die Datei /etc/hostname des node-pod-Dienstes zu schützen und der vi-Anwendung zu erlauben, die Datei zu ändern.

image:example1.png[FileRules]

Zugriffsregel anzeigen, um Dateien im Verzeichnis /var/opt/ rekursiv für Änderungen sowie für das Lesen zu schützen. Die erlaubte Anwendung Python kann Lese- und Änderungszugriff auf diese Dateien haben.

image:example2.png[FileRules]

Zugriffsregel anzeigen, die die Datei /etc/passwd schützt, die eine der Dateien ist, die durch die vordefinierte Zugriffsregel abgedeckt ist, um die Datei-Zugriffsaktion für Änderungen sowie für das Lesen zu ändern. Diese benutzerdefinierte Regel ändert die Standardaktion der vordefinierten Datei-Zugriffsregel. Die Anwendung Nano kann 'lesen und ändern' Zugriff auf diese Dateien haben. Muss auch die Nano-Anwendung (Prozess) als 'erlauben' Regel im Prozessprofil für diesen Dienst hinzufügen, um die Nano-Anwendung innerhalb des Dienstes auszuführen (falls sie dort nicht bereits auf die Whitelist gesetzt wurde), andernfalls wird der Prozess von \{product-name} blockiert.

image:example3.png[FileRules]

Zeigt, dass die Anwendung Python beim Zugriff auf die Datei im Verzeichnis /var/opt gelernt wurde, als der Dienstmodus des Node-Pods im Entdeckungsmodus war. Dies tritt nur auf, wenn die Regel auf Blockieren gesetzt ist und der Dienst im Entdeckungsmodus ist.

image:example4.png[FileRules]

Zeigt vordefinierte Datei-Zugriffsregeln für den Dienst node-pod.demo-nvqa an. Dies kann für diesen Dienst angezeigt werden, indem Sie auf das Informationssymbol "`vordefinierte Filter anzeigen`" in der rechten Ecke des Tabs für die Datei-Zugriffsregel klicken.

image:predefined.png[FileRules]

Zeigt ein Beispiel für ein Sicherheitsereignis in Benachrichtigungen -> Sicherheitsereignisse, das als Datei-Zugriffsverweigerung alarmiert wurde, als die Änderung der Datei /etc/hostname durch die Anwendung Python aufgrund einer benutzerdefinierten Datei-Zugriffsregel mit Blockaktion verweigert wurde.

image:securityevent.png[FileRules]

=== Test_DreiAndere Antworten

Wenn andere spezielle Milderungen, Antworten oder Warnungen für Dateisystemverletzungen gewünscht sind, kann eine Antwortregel erstellt werden. Siehe das Beispiel unten und den Abschnitt Laufzeit-Sicherheitsrichtlinie -> Antwortregeln für weitere Details.

image:file-response1.png[FileResponse]

== Test_DreiGeteilte Modus Datei-Schutzmaßnahmen

Containergruppen können Prozess-/Dateiregeln in einem anderen Modus als Netzwerkregeln haben, wie xref:modes.adoc#_network_service_policy_mode[hier] beschrieben.
