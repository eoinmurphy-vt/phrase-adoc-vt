= Test_TwoProcess Profil Règles
:revdate: 2025-03-31
:page-revdate: {revdate}
:page-opendocs-origin: /05.policy/06.processrules/06.processrules.md
:page-opendocs-slug:  /stratégie/processusrègles

== Test_TwoStratégie -> Groupes -> Règles de Profil de Processus

Il existe deux types de protections de Processus/Fichier dans \{product-name}. L'un est Zero-drift, où l'activité de processus et de fichier autorisée est automatiquement déterminée en fonction de l'image du conteneur, et le second est basé sur un apprentissage comportemental. Chacun peut être personnalisé (règles ajoutées manuellement) si désiré.

[NOTE]
====
Il y a une limitation lors de l'exécution sur des systèmes avec le système de fichiers AUFS, où une condition de concurrence peut être rencontrée et les règles de processus ne sont pas appliquées pour le blocage (mode Protect). Cependant, ces violations sont toujours signalées dans les journaux d'événements de sécurité.
====

=== Test_TwoProtection de Processus Zero-drift

C'est le mode par défaut pour les protections de processus et de fichiers. Zero-drift permet automatiquement uniquement les processus qui proviennent du processus parent qui se trouve dans l'image de conteneur d'origine, et n'autorise pas les mises à jour de fichiers ou l'installation de nouveaux fichiers. En mode Découverte ou Surveillance, zero-drift alertera sur toute activité de processus ou de fichier suspecte. En mode Protect, il bloquera une telle activité. Zero-drift ne nécessite pas que les processus soient appris ou ajoutés à une liste d'autorisation. Désactiver zero-drift pour un groupe fera en sorte que les règles de processus et de fichiers énumérées pour le groupe prennent effet à la place.

[NOTE]
====
(1) Les règles de processus/fichier énumérées pour chaque groupe sont toujours appliquées, même lorsque zero-drift est activé. Cela offre un moyen d'ajouter des exceptions d'autorisation/refus aux protections de base de zero-drift. Gardez à l'esprit que si un groupe commence en mode Découverte, les règles de processus/fichier peuvent être automatiquement ajoutées à la liste, et doivent être examinées et modifiées avant de passer aux modes Surveillance/Protection.

(2) Il est recommandé de définir des espaces de noms de confiance système (de facto) (système et plugin réseau) comme protection de BASE. Des exemples d'espaces de noms à définir sont "kube-system", "openshift-ovn-kubernetes", "ovn-*" etc. Définir d'autres pods d'application comme zéro-dérive.
====

La possibilité d'activer/désactiver le mode zéro-dérive se trouve dans la console dans les groupes de stratégie ->. Plusieurs groupes peuvent être sélectionnés pour basculer ce paramètre pour tous les groupes sélectionnés.

=== Test_TwoProtection du Processus en Mode Basique

Le zéro-dérive peut être désactivé, passant à la protection de processus basique. La protection basique impose une activité de processus/fichier basée sur les règles de processus et/ou de fichiers énumérées pour chaque groupe. Cela signifie qu'il doit y avoir une liste de règles de processus et/ou de règles de fichiers en place pour que la protection ait lieu. Les règles peuvent être créées automatiquement par l'apprentissage comportemental en mode Découverte, créées manuellement via la console ou l'API REST, ou créées par programmation en appliquant un CRD. Avec la protection basique activée, s'il n'y a pas de règles en place, toute activité sera alertée/bloquée en mode Surveillance ou Protection.

=== Test_TwoProtection du Processus Basée sur l'Apprentissage Comportemental

Les règles de profil de processus utilisent l'apprentissage de base pour profiler les processus qui devraient être autorisés à s'exécuter dans un groupe de conteneurs (c'est-à-dire un groupe). Dans des conditions normales dans un environnement de microservices, pour les conteneurs avec une image particulière, seuls un ensemble limité de processus par des utilisateurs spécifiques s'exécuteraient. Si le conteneur est attaqué, l'attaquant malveillant initierait probablement de nouveaux programmes rarement vus dans ce conteneur. Ces événements anormaux peuvent être détectés par \{product-name} et des alertes et actions générées (voir aussi Règles de Réponse).

Les informations de base sur le processus seront apprises et enregistrées lorsque le groupe de services est en mode Découverte (apprentissage). Lorsqu'il est en mode Surveillance ou Protection, si un processus qui n'a pas été vu auparavant est nouvellement démarré, ou si un ancien processus est démarré par un utilisateur différent de celui d'avant, l'événement sera détecté et alerté comme un processus suspect en mode Surveillance ou alerté et bloqué en mode Protection. Les utilisateurs peuvent modifier le profil appris pour autoriser ou refuser (liste blanche ou liste noire) des processus manuellement si nécessaire.

Notez qu'en plus des processus de base, \{product-name} dispose d'une détection intégrée des processus suspects courants tels que nmap, shell inversé, etc. Ces derniers seront détectés et alertés/bloqués à moins d'être explicitement mis sur liste blanche pour chaque service de conteneur.

[IMPORTANT]
====
Les sondes de vivacité de Kubernetes sont automatiquement autorisées et ajoutées aux règles de processus apprises même en mode Surveillance/Protection.
====

=== Test_TwoProcess Règles pour les Nœuds

Le groupe réservé spécial 'nœuds' peut être configuré pour appliquer des règles de profil de processus sur chaque nœud (hôte) dans le cluster. Sélectionnez le groupe 'nœuds' et examinez les règles de processus, en les modifiant si nécessaire. Puis changez le mode de protection en Surveiller ou Protéger. La liste des règles de processus 'locales' (apprises) est une combinaison de tous les processus de tous les nœuds dans le cluster en mode Découverte.

=== Test_TwoProcess Règles pour Groupes Personnalisés

Pour les groupes personnalisés définis par l'utilisateur, les règles de processus, si désirées, doivent être ajoutées manuellement. Les groupes personnalisés n'apprennent pas automatiquement les règles de processus.

=== Test_TwoProcess Précédence des Règles

Les règles de processus peuvent exister pour des groupes personnalisés définis par l'utilisateur ainsi que pour des groupes auto-appris. Les règles créées pour des groupes personnalisés ont la priorité sur les règles pour des groupes auto-appris.

Pour la liste des règles de processus dans n'importe quel groupe, l'ordre des règles dans la console détermine sa priorité. Les règles les plus hautes listées sont appariées en premier avant celles en dessous.

Les règles de processus avec un nom et un chemin contenant tous deux des caractères génériques ont la priorité sur d'autres règles pour l'action Autoriser. Une action Refuser n'est pas autorisée avec des caractères génériques pour éviter de bloquer tous les processus.

Les règles de processus avec une action Refuser et un caractère générique dans le nom auront la priorité sur les actions Autoriser avec un caractère générique dans le nom.

=== Test_TwoMode Découverte

* Tous les nouveaux processus sont profilés avec l'action autoriser
* Les utilisateurs peuvent changer l'action en 'refuser' pour générer une alerte ou bloquer lorsque le même nouveau processus est démarré
* Les utilisateurs peuvent créer un profil pour un processus avec soit autoriser soit refuser
* Les règles de profil de processus peuvent contenir un nom et/ou un chemin
* Le caractère générique &#42; peut être utilisé pour correspondre à tout pour le nom ou le chemin

[NOTE]
====
Un processus suspect (détection intégrée), tel que nmap, ncat, etc., est signalé comme un événement de processus suspect et ne sera PAS appris. Si un service a besoin de ce processus, le processus doit être ajouté avec une règle de profil 'autoriser' explicitement.
====

=== Test_TwoMonitor/Mode de protection (nouveau conteneur démarré en mode surveillance ou protection)

* Chaque nouveau processus génère une alerte
* Les règles de profil de processus peuvent contenir un nom et/ou un chemin
* Le caractère générique &#42; peut être utilisé pour correspondre à tout pour le nom ou le chemin

Si a) le processus correspond à une règle de refus, ou b) le processus n'est pas dans la liste des règles d'autorisation, alors :

* En mode surveillance, des alertes seront générées
* En mode protection, les processus seront bloqués et des alertes générées

[NOTE]
====
Les plateformes de conteneurs avec le pilote de stockage AUFS introduiront un délai dans le mécanisme de blocage en raison des limitations du pilote.
====

[NOTE]
====
En mode protection, les conteneurs système tels que ceux de Kubernetes, ne permettront pas l'action de blocage mais généreront un événement de violation de processus s'il y a une violation de processus.
====

=== Test_TwoCréation de règles de profil de processus

Plusieurs règles peuvent être créées pour le même processus. Les règles sont exécutées séquentiellement et la première règle correspondante sera exécutée.

* Cliquez sur Ajouter une règle (+) dans l'onglet des règles de profil de processus
* Les règles de profil de processus peuvent contenir un nom et/ou un chemin
* Le caractère générique &#42; peut être utilisé pour correspondre à tout pour le nom ou le chemin

Exemple :  Pour autoriser le processus ping à s'exécuter depuis n'importe quel répertoire

image:ping.png[pingRule]

Les violations seront enregistrées dans Notifications -> Événements de sécurité.

image:process_event.png[violation]

=== Détection de processus suspects intégrée Test_Two

Les détections intégrées suivantes sont automatiquement activées dans \{product-name}.

|===
| Processus | Direction | Nom signalé

| nmap
| sortant
| scanner de port

| nc
| sortant
| processus netcat

| ncat
| sortant
| processus netcat

| netcat
| sortant
| processus netcat

| sshd
| entrant
| ssh depuis distant

| ssh
| sortant
| ssh vers distant

| scp
| sortant
| copie sécurisée

| telnet
| sortant
| telnet vers distant

| in.telnetd
| entrant
| telnet depuis distant

| iode
| sortant
| tunneling DNS

| iodiné
| entrant
| tunneling DNS

| dnscat
| sortant
| tunneling DNS

| dns2tcpc
| sortant
| tunneling DNS

| dns2tcpd
| entrant
| tunneling DNS

| socat
| sortant
| processus de relais
|===

De plus, les détections suivantes sont activées :

* docker cp
* élévation de privilèges root (rôle utilisateur en rôle root)
* tunnel : shell inversé (déclenché lorsque stdin et stdout sont redirigés vers le même socket)

Les processus suspects sont alertés lorsqu'ils sont en mode Découverte ou Surveillance, et bloqués lorsqu'ils sont en mode Protection. La détection s'applique aux conteneurs ainsi qu'aux hôtes, à l'exception de 'sshd' qui n'est pas considéré comme suspect sur les hôtes. Les processus énumérés ci-dessus peuvent être ajoutés à la liste d'autorisation pour les conteneurs (Groupes) y compris les hôtes s'ils doivent être autorisés.

== Test_TwoSplit Mode Processus/Protections de Fichier

Les Groupes de Conteneurs peuvent avoir des règles de Processus/Fichier dans un mode différent de celui des règles Réseau, comme décrit xref:modes.adoc#_network_service_policy_mode[ici].
