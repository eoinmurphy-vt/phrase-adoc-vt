= Multi-Cluster Unternehmensverwaltung
:revdate: 2024-09-27
:page-revdate: {revdate}
:page-opendocs-origin: /04.navigation/02.multicluster/02.multicluster.md
:page-opendocs-slug:  /navigation/multicluster

== Unternehmenskonsole

Die Konsole {product-name} kann verwendet werden, um große Multi-Cluster- und Multi-Cloud-Implementierungen zu verwalten. Ein Cluster muss als Hauptcluster ausgewählt werden, und andere entfernte Cluster können sich dann mit dem Hauptcluster verbinden. Sobald verbunden, kann das Hauptcluster föderierte Regeln an jedes entfernte Cluster pushen, die als föderierte Regeln in den Konsolen jedes entfernten Clusters angezeigt werden. Die gescannten föderierten Register synchronisieren ebenfalls die Scanergebnisse mit den entfernten Clustern. Nur lokale Benutzer und Rancher-Benutzer mit Administratorrechten können ein Cluster zum Hauptcluster befördern.

Neben der föderierten Richtlinie unterstützt die Multi-Cluster-Verwaltung die Überwachung jedes entfernten Clusters auf einer Zusammenfassungsseite, wie unten gezeigt.

image:multicluster_summary.png[Résumé]

Es MUSS eine Netzwerkverbindung zwischen den Controllern jedes Clusters über die erforderlichen Ports bestehen. Der Controller ist über einen Haupt- oder entfernten Dienst außerhalb seines Clusters exponiert, wie im yaml-Bereitstellungsbeispiel {product-name} zu sehen ist.

== Konfiguration der Haupt- und entfernten Cluster

Melden Sie sich bei der Konsole des Clusters an, der das Hauptcluster sein wird. Wählen Sie im Dropdown-Menü oben rechts mehrere Cluster aus und dann Befördern, um das Hauptcluster zu konfigurieren. Hinweis: Nur lokale Benutzer und Rancher-Benutzer mit Administratorrechten können ein Cluster zum Hauptcluster befördern. Derzeit dürfen SSO/LDAP/OIDC-Benutzer mit Administratorrolle kein Cluster zum Hauptcluster befördern.
image:master1.png[MasterConfig]

Geben Sie die öffentliche IP und den Port des fed-master-Dienstes ein. Sie können es finden, indem Sie ausführen

[,shell]
----
kubectl get svc -n neuvector
----

La sortie ressemblera à :

[,shell]
----
NAME                                      TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                         AGE
neuvector-service-controller-fed-master   LoadBalancer   10.27.249.147   35.238.131.23    11443:31878/TCP                 17d
neuvector-service-controller-fed-worker   LoadBalancer   10.27.251.1     35.226.199.111   10443:32736/TCP                 17d
----

Im obigen Beispiel ist der Hostname/IP des Hauptcontrollers 35.238.131.23 und der Port ist 11443. Hinweis: Stellen Sie sicher, dass diese IP-Adresse und dieser Port von außen (von den entfernten Clustern) zugänglich sind. Hinweis: Die Systemuhren (Zeit) müssen für jeden Haupt- und entfernten Cluster gleich sein, um korrekt zu funktionieren.

Nachdem Sie sich erneut mit der Konsole verbunden haben, wählen Sie erneut "Mehrere Cluster" im Menü oben rechts aus und klicken Sie auf das Symbol, um ein Token zu generieren, das erforderlich ist, um die entfernten Cluster zu verbinden. Copiez le jeton pour l'utiliser à l'étape suivante. Das Token ist etwa 1 Stunde gültig, und wenn es abläuft, muss es erneut generiert werden, um zukünftige entfernte Cluster zu verbinden.

image:master_token.png[Token]

Um sich mit einem entfernten Cluster mit dem Hauptcluster zu verbinden, melden Sie sich als Administrator an der Konsole des entfernten Clusters an. Sélectionnez Plusieurs Clusters dans le menu déroulant en haut à droite, et cliquez sur Rejoindre. Geben Sie die IP oder den Hostnamen des Controllers für den entfernten Cluster sowie den Port ein. Noch einmal, Sie können diese Informationen vom entfernten Cluster abrufen, indem Sie Folgendes tun:

[,shell]
----
kubectl get svc -n neuvector
----

Verwenden Sie die Ausgabe für den fed-worker des entfernten Clusters, um die IP-Adresse und den Port zu konfigurieren. Ensuite, entrez le jeton copié depuis le principal. Beachten Sie, dass nach der Eingabe des Tokens die IP-Adresse und der Port für das Hauptcluster automatisch ausgefüllt werden, dies jedoch geändert oder manuell eingegeben werden kann.

image:join_remote.png[JoinRemote]

Déconnectez-vous du cluster distant et reconnectez-vous au principal. Oder wenn Sie bereits verbunden sind, klicken Sie auf "Aktualisieren" und der entfernte Cluster wird im Menü "Mehrere Cluster" aufgeführt.

image:fed_master_list.png[FedMaster]

Sie können auf das Verwaltungssymbol in der Liste klicken oder das Dropdown-Menü für mehrere Cluster oben verwenden, um jederzeit zwischen Clustern zu wechseln. Sobald Sie zu einem entfernten Cluster gewechselt haben, gelten alle Elemente im Menü links jetzt für den entfernten Cluster.

== Dépannage

Um sicherzustellen, dass die Dienste wie erwartet reagieren, können Sie die Tests von außerhalb der Cluster ausführen oder, falls erforderlich, von den Test-Pods auf den Clustern `+fed-master+` und `+fed-managed+`, um sicherzustellen, dass die Netzwerkverbindung zwischen den Clustern erlaubt ist.

=== Überprüfen Sie den Dienst fed-master

Der Dienstport des Clusters `+11443+` ist nur nach Aktivierung des Dienstes `+fed-master+` zugänglich. Der folgende Befehl gibt einen Fehlercode zurück, wenn der Dienst `+fed-master+` antwortet, um anzuzeigen, dass die angeforderte Ressource nicht verfügbar ist.

.Beispielausgabe
[,shell]
----
{"code":1,"error":"URL not found","message":"URL not found"}
----

[IMPORTANT]
====
Die URL für den Befehl `+curl+` hängt davon ab, wie der Dienst `+fed-master+` bereitgestellt wird. Wenn ein Dienst `+ingress+` konfiguriert ist, ist es nicht erforderlich, einen Port anzugeben.
====

[,shell]
----
curl -v https://<fed-master>[:<port>]/v1/eula
----

=== Überprüfen Sie den Dienst fed-managed

Der Dienstport des Clusters `+10443+` wird zwischen `+REST API+` und dem Dienst `+fed-managed+` geteilt. Der folgende Befehl gibt einen Erfolgscode zurück, wenn der Dienst `+fed-managed+` antwortet, um anzuzeigen, dass er verfügbar ist.

.Beispielausgabe
[,shell]
----
{"eula":{"accepted":true}})
----

[IMPORTANT]
====
Die URL für den Befehl `+curl+` hängt davon ab, wie der Dienst `+fed-managed+` bereitgestellt wird. Wenn ein Dienst `+ingress+` konfiguriert ist, ist es nicht erforderlich, einen Port anzugeben.
====

[,shell]
----
curl -v https://<fed-managed>[:<port>]/v1/eula
----

== Politique fédérée

Bitte konsultieren Sie den Abschnitt Richtlinie -> Föderierte Richtlinie für Anweisungen zur Erstellung von föderierten Regeln, die an jeden Cluster weitergegeben werden.

== Registres fédérés pour les résultats de numérisation d'images distribuées

Le cluster principal (maître) peut scanner un registre/dépôt désigné comme registre fédéré. Die Scanergebnisse dieser Register werden mit allen verwalteten (entfernten) Clustern synchronisiert. Dies ermöglicht die Anzeige der Scanergebnisse in der Konsole des verwalteten Clusters sowie die Verwendung der Ergebnisse in den Zulassungsregeln des verwalteten Clusters. Register müssen nur einmal gescannt werden, anstatt von jedem Cluster, wodurch die CPU-/Speicher- und Netzwerkbandbreitennutzung reduziert wird.

Föderierte Register können nur von einem föderierten Administrator im Hauptcluster in Assets -> Register konfiguriert werden. Nachdem ein föderiertes Repository hinzugefügt und gescannt wurde, werden die Scanergebnisse mit allen verwalteten Clustern synchronisiert. Die Zulassungsregeln in jedem verwalteten Cluster, die einen Bildscan erfordern (z. B. CVEs, compliance-basierte Regeln), verwenden automatisch sowohl die Ergebnisse von föderierten Scans als auch die Ergebnisse von lokal konfigurierten Registerscans.

=== Föderation der Ergebnisse von CI/CD-Scannern (optional)

Die Ergebnisse von föderierten Registerscans werden immer mit den verwalteten Clustern synchronisiert, wie oben beschrieben. Der Hauptcluster kann auch Scanergebnisse xref:scanners.adoc#_standalone_scanner_for_local_scanning[von eigenständigen Scannern] oder Scanner-Plugins empfangen, die aus einer CI/CD-Bau-Pipeline aufgerufen werden. Um die Scanergebnisse des Bauphasen-Repositorys (CI/CD) auch mit den verwalteten Clustern zu synchronisieren, aktivieren Sie dies zunächst, indem Sie die Einstellungen des Hauptclusters (Master) wie unten angegeben ändern.

image:fed_primary_config.png[master_settings]

image:fed_reg_sync.png[fed_sync]
