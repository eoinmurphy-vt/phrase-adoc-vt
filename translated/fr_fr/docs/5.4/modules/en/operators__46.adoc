= Déploiement à l'aide d'opérateurs
:revdate: 2025-06-02
:page-revdate: {revdate}
:page-opendocs-origin: /02.deploying/01.production/02.operators/02.operators.md
:page-opendocs-slug: /déploiement/production/opérateurs

== Opérateurs

Les opérateurs utilisent les connaissances opérationnelles humaines et les encodent dans des logiciels qui sont plus faciles à partager avec les consommateurs. Les opérateurs sont des logiciels qui facilitent la complexité opérationnelle de l'exécution d'un autre logiciel. Plus techniquement, les opérateurs sont une méthode de conditionnement, de déploiement et de gestion d'une application Kubernetes.

== {product-name} Opérateurs

L'opérateur {product-name} est basé sur le tableau {product-name} Helm. L'opérateur RedHat OpenShift {product-name} s'exécute dans la plateforme de conteneurs OpenShift pour déployer et gérer les composants du cluster de sécurité {product-name}. Le site {product-name} Operator contient toutes les informations nécessaires pour déployer {product-name} à l'aide des cartes Helm. Il suffit d'installer l'opérateur {product-name} depuis le hub OpenShift embedded Operator et de créer l'instance {product-name}.

Pour déployer les dernières versions du conteneur {product-name}, utilisez l' link:https://catalog.redhat.com/search?searchType=software&deployed_as=Operator&partnerName={product-name}&p=1[opérateur certifié Red Hat] depuis Operator Hub ou l' link:https://github.com/redhat-openshift-ecosystem/community-operators-prod/tree/main/operators/neuvector-community-operator[]. La documentation relative à l'opérateur communautaire est disponible à l https://github.com/neuvector/neuvector-operator['adresse suivante :].

[NOTE]
.Note sur le SCC et la mise à jour
====

Privileged SCC est ajouté au compte de service spécifié dans le yaml de déploiement par Operator version 1.3.4 et supérieure dans les nouveaux déploiements. Dans le cas d'une mise à jour de l'Opérateur {product-name} d'une version antérieure à la version 1.3.4, veuillez supprimer le SCC privilégié avant de procéder à la mise à jour.

[,shell]
----
oc delete rolebinding -n neuvector system:openshift:scc:privileged
----
====

[IMPORTANT]
====
{product-name} Les versions certifiées de l'opérateur sont liées aux versions du produit {product-name}, et chaque nouvelle version doit passer par un processus de certification avec Red Hat avant d'être publiée. La version certifiée de l'opérateur pour 5.3.x est liée à la version 2.7.2 de helm et à la version 5.3.2 de l'application {product-name}. La version 1.3.9 de l'opérateur certifié est liée à la version 5.2.0 de {product-name}. La version 1.3.7 de l'opérateur certifié est liée à la version 5.1.0 de {product-name}. La version 1.3.4 de l'opérateur est liée à {product-name} 5.0.0. Si vous souhaitez pouvoir modifier les étiquettes de version des conteneurs {product-name} déployés, veuillez utiliser la version Community.
====

.Déploiement à l'aide d'un opérateur certifié
[%collapsible]
======
*Déployer à l'aide de Red Hat Certified Operator à partir de Operator Hub*

[IMPORTANT]
====
{product-name} Les versions des opérateurs sont liées aux versions des produits {product-name}, et chaque nouvelle version de produit doit passer par un processus de certification avec Red Hat avant d'être publiée.
====

*Notes techniques*

* {product-name} Les images des conteneurs sont extraites de registry.connect.redhat.com à l'aide du secret d'extraction des images de la place de marché RedHat.
* L'interface utilisateur du gestionnaire {product-name} est généralement exposée via une route passthrough OpenShift sur un domaine. Par exemple, sur IBM Cloud neuvector-route-webui-neuvector.(cluster_name)-(random_hash)-0000.(region).containers.appdomain.cloud. Il peut également être exposé en tant que service neuvector-service-webui par le biais d'une adresse de port de nœud ou d'une IP publique.
* Version d'OpenShift >=4.6.

. Créer le projet neuvector
+
--
[,shell]
----
oc new-project neuvector
----
--
. Installer l'Opérateur Certifié RedHat depuis le Hub de l'Opérateur 
** Dans l'interface OpenShift Console, naviguez vers OperatorHub 
** Recherchez {product-name} Operator et sélectionnez la liste sans badge de communauté ou de place de marché. 
** Cliquez sur Installer
. Configurer le canal de mise à jour 
** Le canal le plus récent est le canal bêta, mais il est possible qu'il soit déplacé vers le canal stable à l'avenir. 
** Sélectionner stable si disponible
. Configurer le mode d'installation et l'espace de noms installé 
** Sélectionner un espace de noms spécifique sur le cluster 
** Sélectionner neuvector comme espace de noms installé 
** Configurer la stratégie d'approbation
. Confirmer l'installation
. Préparez les valeurs de configuration YAML pour l'installation de {product-name} comme indiqué dans l'exemple de capture d'écran ci-dessous. Le YAML présenté dans la console OpenShift fournit toutes les options de configuration disponibles et leurs valeurs par défaut. 
+
image:operator_cert.png[]
. Lorsque l'opérateur est installé et prêt à l'emploi, une instance {product-name} peut être installée. 
** Cliquez sur Afficher l'opérateur (après l'installation de l'opérateur) ou sélectionnez l'opérateur {product-name} dans la liste des opérateurs installés. 
** Cliquez sur Créer une instance 
** Sélectionnez Configurer via la vue YAML 
** Coller les valeurs de configuration YAML préparées 
** Cliquez sur Créer
. Vérifier l'installation de l'instance {product-name}  
** Naviguer vers les détails de l'opérateur {product-name}  
** Ouvrez l'onglet {product-name}  
** Sélectionner l'instance neuvector-default 
** Ouvrir l'onglet Ressources 
** Vérifier que les ressources ont le statut Créé ou En cours d'exécution

Après avoir déployé avec succès la plate-forme {product-name} sur votre cluster, connectez-vous à la console {product-name} à l'adresse `+https://neuvector-route-webui-neuvector.(OC_INGRESS)+`. * Connectez-vous avec le nom d'utilisateur initial admin et le mot de passe admin. * Acceptez l'accord de licence de l'utilisateur final de {product-name}. * Changez le mot de passe de l'utilisateur admin. En option, vous pouvez également créer des utilisateurs supplémentaires dans le menu Paramètres -> Utilisateurs et rôles. Vous êtes maintenant prêt à naviguer dans la console {product-name} pour lancer l'analyse des vulnérabilités, observer les pods d'application en cours d'exécution et appliquer des protections de sécurité aux conteneurs.

*Mise à niveau {product-name}*

Mettre à jour la version de {product-name} en mettant à jour la version de l'opérateur qui est associée à la version souhaitée de {product-name}.
======

.Déploiement à l'aide de l'opérateur communautaire
[%collapsible]
======
*Déploiement à l'aide de l'opérateur communautaire {product-name} depuis Operator Hub*

*Notes techniques*

* {product-name} Les images de conteneurs sont extraites de Docker Hub à partir du compte {product-name}. 
* {product-name} est généralement exposée via une route passthrough OpenShift sur un domaine. Par exemple, sur IBM Cloud neuvector-route-webui-neuvector.(cluster_name)-(random_hash)-0000.(region).containers.appdomain.cloud. Il peut également être exposé en tant que service neuvector-service-webui par le biais d'une adresse de port de nœud ou d'une IP publique. 
* OpenShift version 4.6+ 
* Il est recommandé de revoir et de modifier la configuration de l'installation de {product-name} en modifiant les valeurs yaml avant de créer l'instance de {product-name}. Les exemples incluent le nom imagePullSecrets, la version de l'étiquette, l'accès à l'entrée/à la console, la fédération multi-cluster, le volume persistant PVC, etc. Veuillez vous référer aux instructions de Helm à https://github.com/neuvector/neuvector-helm pour les valeurs qui peuvent être modifiées lors de l'installation.

. Créer le projet neuvector
+
--
[,shell]
----
oc new-project neuvector
----
--
. Installer l'opérateur communautaire {product-name} à partir du Hub de l'opérateur 
** Dans l'interface OpenShift Console, naviguez vers OperatorHub 
** Recherchez {product-name} Operator et sélectionnez la liste avec le badge communautaire. 
** Cliquez sur Installer 
** Configurer le canal de mise à jour. Le canal le plus récent est actuellement en version bêta, mais il est possible qu'il passe en version stable à l'avenir. Sélectionner stable si disponible. 
** Configurer le mode d'installation et l'espace de noms installé 
** Sélectionner un espace de noms spécifique sur le cluster 
** Sélectionner neuvector comme espace de noms installé 
** Configurer la stratégie d'approbation 
** Confirmer l'installation
. Téléchargez le manifeste secret Kubernetes qui contient les informations d'identification pour accéder au registre de conteneurs {product-name}. Enregistrez le fichier manifeste YAML dans ./neuvector-secret-registry.yaml.
. Appliquer le manifeste secret Kubernetes contenant les informations d'identification du registre.
+
--
[,shell]
----
kubectl apply -n neuvector -f ./neuvector-secret-registry.yaml
----
--
. Préparez les valeurs de configuration YAML pour l'installation de {product-name} à partir de l'extrait YAML suivant. Veillez à spécifier la version souhaitée de {product-name} dans la valeur "tag". Consultez la référence des valeurs dans le tableau {product-name} Helm pour connaître les options de configuration disponibles. Il existe d'autres valeurs Helm possibles qui peuvent être configurées dans le YAML, par exemple si vous configurez le cluster pour permettre une gestion multi-clusters en exposant les services maître (Federated Master) ou à distance (Federated Worker).
+
--
[,yaml]
----
apiVersion: apm.neuvector.com/v1alpha1
kind: Neuvector
metadata:
  name: neuvector-default
  namespace: neuvector
spec:
  openshift: true
  tag: 4.3.0
  registry: docker.io
  exporter:
    image:
      repository: prometheus-exporter
      tag: 0.9.0
  manager:
    enabled: true
    env:
      ssl: true
    image:
      repository: manager
    svc:
      type: ClusterIP
      route:
        enabled: true
        termination: passthrough
  enforcer:
    enabled: true
    image:
      repository: enforcer
  cve:
    updater:
      enabled: true
      image:
        repository: updater
        tag: latest
      schedule: 0 0 * * *
    scanner:
      enabled: true
      replicas: 3
      image:
        repository: scanner
        tag: latest
  controller:
    enabled: true
    image:
      repository: controller
    replicas: 3
----
--
. Lorsque l'opérateur est installé et prêt à l'emploi, une instance {product-name} peut être installée. 
** Cliquez sur Afficher l'opérateur (après l'installation de l'opérateur) ou sélectionnez l'opérateur {product-name} dans la liste des opérateurs installés. 
** Cliquez sur Créer une instance 
** Sélectionnez Configurer via la vue YAML 
** Coller les valeurs de configuration YAML préparées 
** Cliquez sur Créer
. Vérifiez l'installation de l'instance {product-name}. 
** Naviguer vers les détails de l'opérateur {product-name}  
** Ouvrez l'onglet {product-name}  
** Sélectionner l'instance neuvector-default 
** Ouvrir l'onglet Ressources 
** Vérifier que les ressources ont le statut Créé ou En cours d'exécution
. Après avoir déployé avec succès la plate-forme {product-name} sur votre cluster, connectez-vous à la console {product-name} à l'adresse `+https://neuvector-route-webui-neuvector.(INGRESS_DOMAIN)+`. 
** Se connecter avec le nom d'utilisateur initial admin et le mot de passe admin. 
** Accepter l'accord de licence de l'utilisateur final de {product-name}. 
** Modifier le mot de passe de l'utilisateur admin. 
** En option, vous pouvez également créer des utilisateurs supplémentaires dans le menu Paramètres -> Utilisateurs et rôles.

Vous êtes maintenant prêt à naviguer dans la console {product-name} pour lancer l'analyse des vulnérabilités, observer les pods d'application en cours d'exécution et appliquer des protections de sécurité aux conteneurs.

*Mise à niveau {product-name}*

. Depuis les opérateurs > Opérateurs installés > {product-name} Opérateur 
+
image:1_Installed.png[]
. Cliquez sur {product-name} pour obtenir la liste des instances 
+
image:2_Instance.png[]
. Cliquez sur YAML pour modifier les paramètres 
+
image:3_YAML.png[]
. Mettre à jour l'étiquette et cliquer sur Enregistrer 
+
image:4_tag_save.png[]
======

=== Dépannage

* Vérifier les valeurs de déploiement de l'opérateur dans le fichier yaml déployé
* Vérifier que la contrainte de contexte de sécurité (SCC) pour {product-name} a bien été ajoutée à l'étape 2.
* Examinez et vérifiez les valeurs de la carte {product-name} Helm.
* Assurez-vous que le chemin d'accès au registre et la balise de version sont correctement définis (opérateur communautaire ; certifié utilisera les valeurs par défaut).
* Assurez-vous que la route vers le service neuvector-route-webui du gestionnaire {product-name} est configurée.
