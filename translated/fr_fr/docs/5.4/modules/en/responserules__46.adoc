= Règles de réponse
:revdate: 2024-09-27
:page-revdate: {revdate}
:page-opendocs-origin: /05.policy/08.responserules/08.responserules.md
:page-opendocs-slug:  /policy/responserules

== Politique : Règles de réponse

Les règles de réponse fournissent un moteur de règles flexible et personnalisable pour automatiser les réponses aux événements de sécurité importants. Les déclencheurs peuvent être des événements de sécurité, des résultats d'analyse de vulnérabilité, des repères CIS, des événements de contrôle d'admission et des événements généraux. Les actions comprennent la mise en quarantaine des conteneurs, les webhooks et la suppression des alertes.

image:response1.png[Règles de réponse]

Création d'une nouvelle règle de réponse à l'aide des éléments suivants :

* Le groupe. Une règle s'applique à un groupe. Veuillez consulter la section Politique de sécurité en temps réel -> Groupes pour plus de détails sur les groupes et sur la manière d'en créer un nouveau si nécessaire.
* Catégorie. Il s'agit du type d'événement, tel qu'un événement de sécurité ou le résultat d'une analyse de vulnérabilité CVE.
* Critères. Spécifiez un ou plusieurs critères. Pour chaque catégorie, des critères différents peuvent être appliqués. Par exemple, en fonction du nom de l'événement, de sa gravité ou du nombre minimum de CVE élevés.
* Action. Sélectionnez une ou plusieurs actions. La quarantaine bloque tout le trafic réseau entrant et sortant d'un conteneur. Webhook exige qu'un point de terminaison webhook soit défini dans Settings -> Configuration. Supprimer le journal empêchera l'enregistrement de cet événement dans les notifications.

image:newrule1.png[NewResponseRules]

[IMPORTANT]
====
Toutes les règles de réponse sont évaluées pour déterminer si elles correspondent à la condition/aux critères. Si plusieurs règles correspondent, chaque action sera exécutée. Ce comportement est différent de celui des règles de réseau, qui sont évaluées de haut en bas et seule la première règle qui correspond sera exécutée.
====

Des événements et des actions supplémentaires continueront d'être ajoutés par {product-name} dans les prochaines versions.

== Configuration détaillée des règles de réponse

Les règles de réponse permettent d'automatiser des réponses telles que la mise en quarantaine, le webhook et la suppression du journal en fonction de certains événements de sécurité. Actuellement, les événements qui peuvent être définis dans la règle de réponse comprennent les journaux d'événements, les journaux d'événements de sécurité, les rapports CVE (analyse de vulnérabilité) et les rapports d'analyse comparative CIS. Les règles de réponse sont appliquées dans tous les modes : Découvrir, Surveiller et Protéger et le comportement est le même pour les trois modes.

Les actions de plusieurs règles seront appliquées si un événement correspond à plusieurs règles. Chaque règle peut avoir plusieurs actions et plusieurs critères de correspondance. Toutes les actions définies seront appliquées aux conteneurs lorsque les événements correspondent aux critères de la règle de réponse. Dans le cas d'une correspondance pour les événements de l'hôte (et non du conteneur), les actions webhook et suppress log sont actuellement prises en charge.

Le site {product-name} comprend 6 règles de réponse par défaut qui sont définies sur l'état &apos;`+disabled,+`&apos;, une pour chaque catégorie. Les utilisateurs peuvent soit modifier une règle par défaut pour l'adapter à leurs besoins, soit en créer de nouvelles. Veillez à activer toutes les règles qui doivent être appliquées.

=== Matrice des paramètres de la règle de réponse

image:resp1.png[matrix]

=== Utilisation de plusieurs critères dans une seule règle

La logique de correspondance pour plusieurs critères dans une règle de réponse est la suivante :

* Pour différents types de critères (par exemple, nom:Violation.du.réseau, nom:Violation.du.profil.du.processus) au sein d'une même règle, appliquer "et".

=== Actions

* Quarantaine -- Le conteneur est mis en quarantaine. La mise en quarantaine signifie que tout le trafic réseau est bloqué.  Le conteneur reste en place et continue de fonctionner, mais sans aucune connexion réseau.  Kubernetes ne démarrera pas un conteneur pour remplacer un conteneur mis en quarantaine, car le serveur api est toujours en mesure d'atteindre le conteneur.
* Webhook - un journal webhook généré
* suppress-log -- le journal est supprimé - à la fois le journal syslog et le journal webhook

[NOTE]
====
* L'action de mise en quarantaine ne s'applique pas aux règles déclenchées pour les événements liés à l'hôte.
* Les paramètres Action et Event sont obligatoires ; les autres paramètres peuvent être vides pour répondre à des conditions plus larges.
* Plusieurs règles peuvent correspondre à un seul journal, ce qui peut entraîner l'exécution de plusieurs actions.
* Chaque règle peut avoir plusieurs actions.
====

=== Création d'une règle de réponse pour les journaux d'événements de sécurité

* Cliquez sur "insérer en haut" pour insérer la règle en haut.
* Choisissez un nom de groupe de services si la règle doit être appliquée à un groupe de services particulier.
* Choisir la catégorie de l'événement de sécurité
* Ajouter des critères pour le journal des événements à inclure dans les critères de correspondance
* Sélectionner les actions à appliquer Quarantaine, Webhook ou suppression du journal
* Statut d'activation
* Les niveaux d'enregistrement ou les noms de processus peuvent être utilisés comme autres critères de correspondance.

=== Exemple de règle pour mettre en quarantaine le conteneur et envoyer un webhook lorsque le paquet est mis à jour dans le conteneur nv.alpinepython.default.

image:resp3.png[exemple de règles]

=== Icônes permettant de gérer les règles - modifier, supprimer, désactiver et insérer une nouvelle règle ci-dessous

image:resp4.png[gérer]

=== Création d'une règle de réponse pour les journaux d'événements

* Cliquez sur "insérer en haut" pour insérer la règle en haut.
* Choisissez un nom de groupe de services si la règle doit être appliquée à un groupe de services particulier.
* Choisissez Événement la catégorie
* Ajouter le nom du journal d'événements à inclure comme critère de correspondance
* Sélectionner les actions à appliquer - Quarantaine, Webhook ou suppression du journal
* Statut d'activation
* Le niveau du journal peut être utilisé comme autre critère de correspondance.

=== Exemples d'événements pouvant être choisis pour une règle de réponse

image:resp5.png[événements]

=== Exemples de critères pour les événements du contrôle d'admission

image:admission.png[événements]

=== Création d'une règle de réponse pour la catégorie cve-report (niveau d'enregistrement et nom du rapport comme critères de correspondance)

* Cliquez sur "insérer en haut" pour insérer la règle en haut.
* Choisissez un nom de groupe de services si la règle doit être appliquée à un groupe de services particulier.
* Choisir la catégorie CVE-Report
* Ajouter le niveau du journal comme critère de correspondance ou type de rapport cve
* Sélectionner les actions à appliquer Quarantaine, Webhook ou suppression du journal (la quarantaine ne s'applique pas à l'analyse du registre)
* Statut d'activation

=== Exemples de types de rapports CVE pouvant être choisis pour la règle de réponse de la catégorie CVE-Report

image:resp7.png[cvereport]

=== Mise en quarantaine d'un conteneur et envoi d'un webhook lorsque les résultats de l'analyse de vulnérabilité contiennent plus de 5 vulnérabilités CVE de haut niveau pour ce conteneur.

image:resp8.png[cvequarantine]

=== Envoyer un webhook si le conteneur contient une vulnérabilité avec le nom cve-2018-12

image:resp8-a.png[webhook]

=== Création d'une règle de réponse pour les benchmarks du CIS (niveau du journal et numéro du benchmark comme critères de correspondance)

* Cliquez sur "insérer en haut" pour insérer la règle en haut.
* Choisissez le nom du groupe de service si la règle doit être appliquée à un groupe de service particulier.
* Choisir une catégorie Benchmark
* Ajouter le niveau du journal comme critère de correspondance ou numéro de référence, par exemple &quot;`+5.12+`&quot; S'assurer que le système de fichiers racine du conteneur est monté en lecture seule.
* Sélectionner les actions à appliquer Quarantaine, Webhook et suppression du journal (la quarantaine ne s'applique pas au benchmark Host Docker et Kubenetes)
* Statut d'activation

image:resp8-b.png[cis]

=== Supprimer la quarantaine d'un conteneur en supprimant la règle de réponse

* Il se peut que vous souhaitiez annuler la mise en quarantaine d'un conteneur s'il est mis en quarantaine par une règle de réponse.
* Supprimer la règle de réponse qui a provoqué la mise en quarantaine du conteneur, qui peut être trouvée dans le journal des événements.
* Sélectionnez l'option de mise hors quarantaine pour mettre le conteneur hors quarantaine après avoir supprimé la règle.

=== Affichage de l'identifiant de la règle responsable de la quarantaine du conteneur (dans Notifications -> Events)

image:resp9.png[unquarantine]

=== Option d'annulation de la quarantaine lorsque la règle de réponse appropriée est supprimée

Cochez la case pour annuler la mise en quarantaine de tous les conteneurs qui ont été mis en quarantaine par cette règle.

image:resp10.png[option]

=== Liste complète des critères catégorisés qui peuvent être configurés pour les règles de réponse

Notez que certains critères nécessitent une valeur (par exemple, cve-high:1, name:D.5.4, level:critical) délimitée par deux points, tandis que d'autres sont prédéfinis et s'affichent dans le menu déroulant lorsque vous commencez à taper un critère.

==== Evénements

[,shell]
----
Container.Start
Container.Stop
Container.Remove
Container.Secured
Container.Unsecured
Enforcer.Start
Enforcer.Join
Enforcer.Stop
Enforcer.Disconnect
Enforcer.Connect
Enforcer.Kicked
Controller.Start
Controller.Join
Controller.Leave
Controller.Stop
Controller.Disconnect
Controller.Connect
Controller.Lead.Lost
Controller.Lead.Elected
User.Login
User.Logout
User.Timeout
User.Login.Failed
User.Login.Blocked
User.Login.Unblocked
User.Password.Reset
User.Resource.Access.Denied
RESTful.Write
RESTful.Read
Scanner.Join
Scanner.Update
Scanner.Leave
Scan.Failed
Scan.Succeeded
Docker.CIS.Benchmark.Failed
Kubenetes.CIS.Benchmark.Failed
License.Update
License.Expire
License.Remove
License.EnforcerLimitReached
Admission.Control.Configured   // for admission control
Admission.Control.ConfigFailed // for admission control
ConfigMap.Load                 // for initial Config
ConfigMap.Failed               // for initial Config failure
Crd.Import                     // for crd Config import
Crd.Remove                     // for crd Config remove due to k8s miss
Crd.Error                      // for remove error crd
Federation.Promote             // for multi-clusters
Federation.Demote              // for multi-clusters
Federation.Join                // for joint cluster in multi-clusters
Federation.Leave               // for multi-clusters
Federation.Kick                // for multi-clusters
Federation.Policy.Sync         // for multi-clusters
Configuration.Import
Configuration.Export
Configuration.Import.Failed
Configuration.Export.Failed
Cloud.Scan.Normal // for cloud scan nomal ret
Cloud.Scan.Alert  // for cloud scan ret with alert
Cloud.Scan.Fail   // for cloud scan fail
Group.Auto.Remove
Agent.Memory.Pressure
Controller.Memory.Pressure
Kubenetes.{product-name}.RBAC
Group.Auto.Promote
User.Password.Alert
----

==== Incidents (événement de sécurité)

[,shell]
----
Host.Privilege.Escalation
Container.Privilege.Escalation
Host.Suspicious.Process
Container.Suspicious.Process
Container.Quarantined
Container.Unquarantined
Host.FileAccess.Violation
Container.FileAccess.Violation
Host.Package.Updated
Container.Package.Updated
Host.Tunnel.Detected
Container.Tunnel.Detected
Process.Profile.Violation // container
Host.Process.Violation    // host
----

==== Menaces (événement de sécurité)

[,shell]
----
TCP.SYN.Flood
ICMP.Flood
Source.IP.Session.Limit
Invalid.Packet.Format
IP.Fragment.Teardrop
TCP.SYN.With.Data
TCP.Split.Handshake
TCP.No.Client.Data
TCP.Small.Window
TCP.SACK.DDoS.With.Small.MSS
Ping.Death
DNS.Loop.Pointer
SSH.Version.1
SSL.Heartbleed
SSL.Cipher.Overflow
SSL.Version.2or3
SSL.TLS1.0or1.1
HTTP.Negative.Body.Length
HTTP.Request.Smuggling
HTTP.Request.Slowloris
DNS.Stack.Overflow
MySQL.Access.Deny
DNS.Zone.Transfer
ICMP.Tunneling
DNS.Type.Null
SQL.Injection
Apache.Struts.Remote.Code.Execution
DNS.Tunneling
K8S.externalIPs.MitM
----

==== Violations (événement de sécurité)

[,shell]
----
Network.Violation
----

==== Conformité

[,shell]
----
Compliance.Container.Violation
Compliance.ContainerFile.Violation
Compliance.Host.Violation
Compliance.Image.Violation
Compliance.ContainerCustomCheck.Violation
Compliance.HostCustomCheck.Violation
Compliance.Test.Name   // D.[1-5].*
----

==== Rapport CVE

[,shell]
----
ContainerScanReport
HostScanReport
RegistryScanReport
PlatformScanReport
cve-name
cve-high
cve-medium
cve-high-with-fix // cve-high-with-fix:N (fixed high vul.>N) cve-high-with-fix:N/D (fixed high vul.>N and reported more than D days ago)
----

==== Admission

[,shell]
----
Admission.Control.Allowed   // for admission control
Admission.Control.Violation // for admission control
Admission.Control.Denied    // for admission control
----

==== Critères générés dynamiquement

[,shell]
----
DLP
WAF
CustomCheckCompliance
----
