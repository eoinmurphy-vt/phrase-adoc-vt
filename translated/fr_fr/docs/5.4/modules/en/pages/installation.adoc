= Préparation au déploiement
:revdate: 2025-01-10
:page-revdate: {revdate}
:page-opendocs-origin: /01.basics/03.installation/01.native/01.native.md
:page-opendocs-slug: /basics/installation

== Comprendre comment déployer {product-name}

Déployez les conteneurs {product-name} en utilisant Kubernetes, OpenShift, Rancher, Docker ou d'autres plateformes. Chaque type de conteneur {product-name} a un but unique et peut nécessiter des exigences de performance ou de sélection de nœud spéciales pour un fonctionnement optimal.

Les images open source {product-name} sont hébergées sur Docker Hub à `+/neuvector/{image name}+`.

Voir la section xref:production.adoc#_best_practices_tips_qa_for_deploying_and_managing_suse_security[Onboarding/Meilleures pratiques] pour télécharger un guide d'intégration.

=== Déployez en utilisant Kubernetes, OpenShift, Rancher ou d'autres outils basés sur Kubernetes

Pour déployer {product-name} en utilisant Kubernetes, OpenShift, Rancher ou d'autres outils d'orchestration, voir les étapes de préparation et les fichiers d'exemple dans la section xref:production.adoc#_planning_deployments[Déploiement de {product-name}]. Cela déploie des conteneurs de gestion, de contrôleur, de scanner et d'application. Pour des tests simples utilisant le conteneur {product-name} Allinone, voir la section Cas d'utilisation spéciaux avec Allinone.

{product-name} prend en charge le déploiement basé sur Helm avec un graphique Helm à https://github.com/neuvector/neuvector-helm.

Les déploiements automatisés sont pris en charge en utilisant Helm, Red Hat/Community Operators, l'API REST ou un ConfigMap Kubernetes. Voir la section xref:configmap.adoc#_kubernetes_configmap[Déployer en utilisant ConfigMap] pour plus de détails sur l'automatisation du déploiement.

=== Déployez en utilisant Docker Native

Avant de xref:docker.adoc[déployer {product-name}] avec docker run ou compose, vous DEVEZ définir le CLUSTER_JOIN_ADDR à l'adresse IP appropriée. Trouvez l'adresse IP du nœud, le nom du nœud (si vous utilisez un serveur de noms), ou la variable de nœud (si vous utilisez des outils d'orchestration) pour l'allinone (contrôleur) à utiliser pour le &quot;`+node IP+`&quot; dans les fichiers docker-compose pour l'allinone et l'application.  Par exemple :

[,yaml]
----
- CLUSTER_JOIN_ADDR=192.168.33.10
----

Pour les déploiements basés sur Swarm, ajoutez également la variable d'environnement suivante :

[,yaml]
----
- NV_PLATFORM_INFO=platform=Docker
----

Voir la section Déploiement {product-name} -> xref:docker.adoc[Déploiement de Docker en production] pour des instructions et des exemples.

=== Sauvegarde des fichiers de configuration

Par défaut, {product-name} stocke divers fichiers de configuration dans /var/neuvector/config/backup sur le contrôleur ou le nœud Allinone.

Ce volume peut être mappé à xref:production.adoc#_backups_and_persistent_data[stockage persistant] pour maintenir la configuration. Les fichiers dans le dossier peuvent devoir être supprimés pour repartir à zéro.

=== Mapping des volumes

Assurez-vous que les volumes sont correctement mappés. {product-name} nécessite cela pour fonctionner (/var/neuvector n'est requis que sur le contrôleur/allinone). Par exemple :

[,yaml]
----
volumes:
        - /lib/modules:/lib/modules:ro
        - /var/neuvector:/var/neuvector
        - /var/run/docker.sock:/var/run/docker.sock:ro
        - /proc:/host/proc:ro
        - /sys/fs/cgroup:/host/cgroup:ro
----

De plus, vous devrez peut-être vous assurer que d'autres outils ne bloquent pas l'accès à l'interface docker.sock.

=== Ports et mapping des ports

Assurez-vous que les ports requis sont correctement mappés et ouverts sur l'hôte. Le Manager ou Allinone nécessite 8443 (si vous utilisez la console). L'Allinone et le contrôleur nécessitent 18300, 18301, 18400, 18401 et éventuellement 10443, 11443, 20443, 30443. L'Enforcer nécessite 18301 et 18401.

[NOTE]
====
Si vous déployez docker natif (y compris SWARM), assurez-vous qu'aucun pare-feu hôte ne bloque l'accès aux ports requis tels que firewalld. Si activé, l'interface docker0 doit être ajoutée comme zone de confiance pour les hôtes allinone/contrôleur.
====

==== Résumé des ports

Le tableau suivant répertorie les communications de chaque conteneur {product-name}. Le conteneur Allinone combine les conteneurs Manager, Controller et Enforcer, donc nécessite les ports listés pour ces conteneurs.

image:Communication_Matrix_From_To.png[Ports]

Le tableau suivant résume les ports d'écoute pour chaque conteneur {product-name}.

image:Communication_Matrix_Listening_Ports.png[Écoute]

===== Ports supplémentaires

Dans la version 5.1, un nouveau port d'écoute a été ajouté sur 8181 dans le contrôleur pour la communication locale uniquement.

[,shell]
----
tcp        0      0 :::8181                 :::*                    LISTEN      8/opa
----
