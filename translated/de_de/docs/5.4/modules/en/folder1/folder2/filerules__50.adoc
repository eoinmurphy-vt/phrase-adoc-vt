= Regeln für den Dateizugriff
:revdate: 2024-09-27
:page-revdate: {revdate}
:page-opendocs-origin: /05.policy/07.filerules/07.filerules.md
:page-opendocs-slug:  /policy/filerules

== Politik: Regeln für den Dateizugriff

Es gibt zwei Arten von Prozess- und Dateischutz in {product-name}. Die eine ist Zero-drift, bei der die erlaubten Prozess- und Datei-Aktivitäten automatisch auf der Grundlage des Container-Images bestimmt werden, und die zweite ist eine verhaltensorientierte Lernmethode. Sie können auf Wunsch angepasst werden (Regeln manuell hinzufügen).

{product-name} verfügt über eine integrierte Erkennung von verdächtigen Dateisystemaktivitäten. Sensible Dateien in Containern werden normalerweise zur Laufzeit nicht verändert. Durch die Änderung des Inhalts der sensiblen Dateien kann ein Angreifer unbefugte Privilegien erlangen, wie z. B. beim Dirty-Cow-Angriff auf den Linux-Kernel, oder die Integrität des Systems beschädigen, z. B. durch Manipulation der Datei /etc/hosts. Die meisten Container laufen nicht im Nur-Lese-Modus. Jede verdächtige Aktivität in Containern, Hosts oder dem {product-name} Enforcer-Container selbst wird erkannt und in Notifications -> Security Events protokolliert.

=== Zero-Drift-Dateischutz

Dies ist der Standardmodus für den Prozess- und Dateischutz. Zero-drift lässt automatisch nur Prozesse zu, die von dem übergeordneten Prozess im ursprünglichen Container-Image stammen, und erlaubt keine Dateiaktualisierungen oder die Installation neuer Dateien. Im Erkennungs- oder Überwachungsmodus warnt zero-drift vor verdächtigen Prozessen oder Dateiaktivitäten. Im Schutzmodus werden solche Aktivitäten blockiert. Bei Zero-drift ist es nicht erforderlich, dass die Dateiaktivität zu einer Zulassen-Liste hinzugefügt wird. Wenn Sie die Nullpunktverschiebung für eine Gruppe deaktivieren, werden stattdessen die für diese Gruppe aufgeführten Prozess- und Dateiregeln wirksam.

[NOTE]
====
Die für jede Gruppe aufgelisteten Prozess-/Dateiregeln werden immer angewendet, auch wenn die Null-Drift aktiviert ist. Dies bietet eine Möglichkeit, Ausnahmen von der Nullpunktverschiebung zuzulassen oder zu verweigern. Denken Sie daran, dass, wenn eine Gruppe im Erkennungsmodus startet, Prozess-/Dateiregeln automatisch zur Liste hinzugefügt werden können und überprüft und bearbeitet werden sollten, bevor sie in den Überwachungs-/Schutzmodus wechseln.
====

Die Möglichkeit, den Zero-Drift-Modus zu aktivieren/deaktivieren, befindet sich in der Konsole unter Policy -> Groups. Es können mehrere Gruppen ausgewählt werden, um diese Einstellung für alle ausgewählten Gruppen umzuschalten.

=== Grundlegende Dateischutzmaßnahmen

Wenn eine Paketinstallation erkannt wird, wird ein automatischer Re-Scan des Containers oder Hosts ausgelöst, um etwaige Schwachstellen zu erkennen, WENN der automatische Scan unter Sicherheitsrisiken -> Schwachstellen aktiviert wurde.

Zusätzlich zur Überwachung von vordefinierten Dateien/Verzeichnissen können Benutzer benutzerdefinierte Dateien/Verzeichnisse hinzufügen, die überwacht werden sollen, und diese Dateien/Verzeichnisse gegen Änderungen sperren.

[IMPORTANT]
====
{product-name} Warnungen und blockiert keine Änderungen an vordefinierten Dateien/Verzeichnissen oder in Systemcontainern, wie z. B. Kubernetes-Containern. Die Sperrung ist nur eine Option für benutzerdefinierte Dateien/Verzeichnisse für Nicht-System-Container. Dadurch wird verhindert, dass regelmäßige Aktualisierungen von Systemordnern oder sensiblen Konfigurationen unbeabsichtigt blockiert werden, was zu einem fehlerhaften Systemverhalten führt.
====

Die folgenden Dateien und Verzeichnisse werden standardmäßig überwacht:

* Ausführbare Dateien
* Empfindliche setuid/setgid-Dateien
* Systembibliotheken, libc, pthread, ...
* Paketinstallation, Debian/Ubuntu, RedHat/CentOS, Alpine
* Sensible Systemdateien, /etc/passwd, /etc/hosts, /etc/resolv.conf ...
* Ausführbare Dateien der laufenden Prozesse

Die folgenden Aktivitäten werden überwacht:

* Dateien, Verzeichnisse, Symlinks (Hardlink und Softlink)
* erstellt, gelöscht, geändert (Inhaltsänderung) und verschoben

Im Folgenden finden Sie eine Liste der Dateisystemüberwachung und der überwachten Elemente (Container, Host/Knoten und/oder {product-name} enforcer container selbst):

* /bin, /usr/bin, /usr/sbin, /usr/local/bin - Container, Durchsetzer
* Dateien der Attribute setuid und setgid - Container, Host, Enforcer
* Bibliotheken: libc, pthread, ld-linux.* - Container, Host, Enforcer
* Paketinstallation: dpkg, rpm, apk - Container, Host, Enforcer
* /etc/hosts, /etc/passwd, /etc/resolv.conf - Container, Host, Durchsetzer
* Binärdateien der laufenden Prozesse - Container

=== Verhaltensbasiertes Lernen Erlaubte Anwendungen im Entdeckungsmodus

Im Erkennungsmodus kann {product-name} Anwendungen NUR für bestimmte Verzeichnisse oder Dateien lernen und in die Whitelist aufnehmen. Um das Lernen zu aktivieren, muss eine benutzerdefinierte Regel erstellt und die Aktion auf Blockieren gesetzt werden, wie unten beschrieben.

=== Erstellen von benutzerdefinierten Regeln für die Datei-/Verzeichnisüberwachung

Benutzerdefinierte Dateizugriffsregeln können sowohl für benutzerdefinierte Gruppen als auch für automatisch erlernte Gruppen erstellt werden.

Benutzer können neue Einträge für Datei-/Verzeichnisregeln hinzufügen.

* Filter: Konfigurieren Sie die zu schützende Datei/den zu schützenden Ordner (Wildcards werden unterstützt)
* Setzen Sie das Rekursiv-Flag (wenn alle Dateien in den Unterverzeichnissen geschützt werden sollen)
* Wählen Sie die Aktion, Überwachen oder Blockieren (siehe Aktionen unten)
* Erlaubte Anwendungen eingeben (siehe Anmerkung1 unten)

image:file_rules.png[FileRules]

Handlungen:

* Dateiänderungen überwachen. Generierung von Warnungen (Benachrichtigungen) bei Änderungen
* Blockieren Sie den unbefugten Zugriff.
** Dienst im Erkennungsmodus: Das Dateizugriffsverhalten wird gelernt (die Prozesse/Anwendungen, die auf die geschützte Datei zugreifen) und zu den zugelassenen Anwendungen hinzugefügt.
** Dienst im Monitormodus: Unerwartetes Dateiverhalten wird gemeldet.
** Dienst im Schutzmodus: unerwarteter Zugriff (Lesen, Ändern) wird blockiert. Die Erstellung neuer Dateien in geschützten Ordnern wird ebenfalls blockiert.

[NOTE]
====
Wenn die Regel auf "Blockieren" eingestellt ist und der Dienst sich im Erkennungsmodus befindet, lernt {product-name} die Anwendungen, die auf die Datei zugreifen, und fügt diese zu den erlaubten Anwendungen für die Regel hinzu.
====

[NOTE]
====
Containerplattformen, auf denen der AUFS-Speichertreiber läuft, unterstützen die Aktion "Verweigern" (Block) im Schutzmodus zum Erstellen/Ändern von Dateien aufgrund der Einschränkungen des Treibers nicht. Das Verhalten ist das gleiche wie im Monitor-Modus, der bei verdächtigen Aktivitäten Alarm schlägt.
====

=== Vorrang der Regeln für den Dateizugriff

Ein Container kann Dateizugriffsregeln von mehreren benutzerdefinierten Gruppen und vom Benutzer erstellten Dateizugriffsregeln auf automatisch gelernte Gruppen erben.

Dateizugriffsregeln werden in der folgenden Reihenfolge priorisiert, wenn der Dateiname mit vordefinierten Zugriffsregeln der automatisch gelernten Gruppe und der Regelvererbung mehrerer Gruppen in Konflikt steht.

* Dateizugriffsregel mit Blockzugriff (höchste Ordnung)
* Dateizugriffsregel mit aktivierter Rekursion
* Dateizugriffsregel mit rekursiver Deaktivierung
* Vom Benutzer erstellte Regeln für den Dateizugriff, die von den vordefinierten Regeln abweichen

==== Beispiele

Dateizugriffsregel anzeigen, um die Datei /etc/hostname des Dienstes node-pod zu schützen und der Anwendung vi zu erlauben, die Datei zu ändern.

image:example1.png[FileRules]

Anzeige der Dateizugriffsregel, um Dateien im Verzeichnis /var/opt/ rekursiv sowohl für Änderungen als auch für das Lesen zu schützen. Die Anwendung Python hat Lese- und Änderungszugriff auf diese Dateien.

image:example2.png[FileRules]

Zeigt die Zugriffsregel, die die Datei /etc/passwd schützt, die eine der Dateien ist, die von der vordefinierten Zugriffsregel abgedeckt werden, um die Dateizugriffsaktion zu ändern, sowohl für Änderungen als auch für das Lesen. Diese benutzerdefinierte Regel ändert die Standardaktion der vordefinierten Dateizugriffsregel. Die Anwendung Nano kann auf diese Dateien "lesend und ändernd" zugreifen. Sie müssen auch die Nano-Anwendung (Prozess) als "Zulassen"-Regel in der Prozessprofil-Regel für diesen Dienst hinzufügen, um die Nano-Anwendung innerhalb des Dienstes auszuführen (wenn sie dort nicht bereits auf der Whitelist steht), ansonsten wird der Prozess von {product-name} blockiert.

image:example3.png[FileRules]

Zeigt, dass die Anwendung python den Zugriff auf die Datei im Verzeichnis /var/opt erlernt hat, als der Dienstmodus von node-pod auf Discover stand. Dies tritt nur auf, wenn die Regel auf Blockieren eingestellt ist und der Dienst sich im Erkennungsmodus befindet.

image:example4.png[FileRules]

Anzeige der vordefinierten Dateizugriffsregeln für den Dienst node-pod.demo-nvqa. Dies kann für diesen Dienst durch Anklicken des Info-Symbols &quot;`+show predefined filters+`&quot; in der rechten Ecke der Registerkarte für die Dateizugriffsregel angezeigt werden.

image:predefined.png[FileRules]

Anzeige eines Beispiels für ein Sicherheitsereignis in Benachrichtigungen -> Sicherheitsereignisse, das als Dateizugriffsverweigerung gemeldet wird, wenn die Änderung der Datei /etc/hostname durch die Anwendung python aufgrund einer benutzerdefinierten Dateizugriffsregel mit Block-Aktion verweigert wurde.

image:securityevent.png[FileRules]

=== Andere Antworten

Wenn andere spezielle Abhilfemaßnahmen, Reaktionen oder Warnungen für Dateisystemverletzungen gewünscht werden, kann eine Reaktionsregel erstellt werden. Weitere Einzelheiten finden Sie im folgenden Beispiel und im Abschnitt Run-Time Security Policy -> Response Rules.

image:file-response1.png[FileResponse]

== Schutz von Dateien im geteilten Modus

Container-Gruppen können Prozess-/Dateiregeln in einem anderen Modus als Netzwerkregeln haben, wie xref:modes.adoc#_network_service_policy_mode[hier] beschrieben.
