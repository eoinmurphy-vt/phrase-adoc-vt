name: Sync Processed Files to phrase-adoc-client

on:
  push:
    paths:
      - 'final/**'  # Trigger on changes to outgoing folder in Repo2
  workflow_dispatch:

jobs:
  sync-back:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout phrase-adoc-vt
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"

      - name: Clone phrase-adoc-client for writing
        run: |
          git clone https://github.com/e-murph/phrase-adoc-client.git temp_repo1  # No PAT needed due to collaborator access
          cd temp_repo1
          git checkout main  # Assume main branch

      - name: Copy processed files to phrase-adoc-client
        run: |
          mkdir -p temp_repo1/final/  # Incoming folder in Repo1
          if ls ../final/* > /dev/null 2>&1; then
            cp -r ../final/* temp_repo1/final/
          else
            echo "No files in final/ to copy; skipping."
          fi

      - name: Commit and push to phrase-adoc-client
        working-directory: temp_repo1
        run: |
          git add final/
          git commit -m "Added processed files from phrase-adoc-vt" || echo "No changes to commit"
          git push origin main

      - name: Clean up
        run: rm -rf temp_repo1
